<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Royal Cafe POS</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Add SheetJS library for Excel export -->
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        /* Login Page Styles */
        .login-page {
            background: linear-gradient(135deg, #db2777 0%, #ec4899 100%);
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .login-container {
            background: white;
            padding: 40px;
            border-radius: 16px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 400px;
        }

        .login-logo {
            text-align: center;
            margin-bottom: 30px;
        }

        .login-logo h1 {
            color: #db2777;
            font-size: 28px;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .login-logo .subtitle {
            color: #666;
            font-size: 14px;
            margin-top: 5px;
        }

        .login-form-group {
            margin-bottom: 20px;
        }

        .login-form-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 500;
        }

        .login-form-group input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e1e1e1;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        .login-form-group input:focus {
            outline: none;
            border-color: #db2777;
        }

        .login-btn {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #db2777 0%, #ec4899 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .login-btn:hover {
            transform: translateY(-2px);
        }

        .login-btn:active {
            transform: translateY(0);
        }

        .login-error-message {
            color: #e74c3c;
            font-size: 14px;
            margin-top: 10px;
            text-align: center;
            display: none;
        }

        .login-demo-credentials {
            background: #fdf2f8;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            font-size: 12px;
            color: #666;
            border: 1px solid #fbcfe8;
        }

        .login-demo-credentials h4 {
            margin-bottom: 8px;
            color: #db2777;
        }

        .user-role-badge {
            display: inline-block;
            padding: 4px 8px;
            background: #db2777;
            color: white;
            border-radius: 12px;
            font-size: 10px;
            font-weight: 600;
            margin-left: 8px;
            text-transform: uppercase;
        }

        .user-role-badge.staff {
            background: #0ea5e9;
        }

        .user-role-badge.admin {
            background: #db2777;
        }

        .hidden {
            display: none !important;
        }

        /* Existing POS Styles */
        body {
            background-color: #fdf2f8;
            color: #333;
            padding: 10px;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        .dashboard {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            min-height: 90vh;
        }
        
        header {
            background: linear-gradient(135deg, #db2777 0%, #ec4899 100%);
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .logo {
            font-size: 24px;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .logo i {
            font-size: 28px;
        }
        
        .header-controls {
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
            background: rgba(255, 255, 255, 0.2);
            padding: 8px 16px;
            border-radius: 50px;
        }
        
        .avatar {
            width: 35px;
            height: 35px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        
        .nav-tabs {
            display: flex;
            background: #fce7f3;
            border-bottom: 1px solid #fbcfe8;
            flex-wrap: wrap;
        }
        
        .nav-tab {
            padding: 12px 20px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
            flex: 1;
            text-align: center;
            min-width: 140px;
        }
        
        .nav-tab.active {
            border-bottom: 3px solid #db2777;
            color: #db2777;
            background: white;
        }
        
        .nav-tab:hover {
            background: #f9a8d4;
            color: white;
        }
        
        .slider-container {
            height: 430px;
            position: relative;
            overflow: hidden;
            background: #fce7f3;
        }
        
        .slider {
            display: flex;
            width: 300%;
            height: 300%;
            transition: transform 0.5s ease-in-out;
        }
        
        .slide {
            flex: 1;
            min-width: 33.33%;
            display: flex;
            align-items: center;
            justify-content: center;
            background-size: cover;
            background-position: center;
            color: white;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            font-size: 20px;
            font-weight: bold;
        }
        
        .slide-1 {
            background: linear-gradient(rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0.3)), 
                        url('https://i.pinimg.com/originals/45/83/02/458302edaeb14ecc2894ac0ee0d54347.gif');
        }
        
        .slide-2 {
            background: linear-gradient(rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0.3)), 
                        url('https://i.pinimg.com/originals/45/83/02/458302edaeb14ecc2894ac0ee0d54347.gif');
        }
        
        .slide-3 {
            background: linear-gradient(rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0.3)), 
                        url('https://i.pinimg.com/originals/45/83/02/458302edaeb14ecc2894ac0ee0d54347.gif');
        }
        
        .slider-nav {
            position: absolute;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 8px;
        }
        
        .slider-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.5);
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .slider-dot.active {
            background: white;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 3fr 1fr;
            gap: 15px;
            padding: 15px;
            flex: 1;
            overflow: hidden;
            min-height: 400px;
        }
        
        .order-section {
            background: white;
            border-radius: 12px;
            padding: 15px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            border: 1px solid #fbcfe8;
            min-height: 500px;
        }
        
        .order-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            padding-bottom: 12px;
            border-bottom: 2px solid #fdf2f8;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .search-container {
            margin-bottom: 15px;
            position: relative;
        }
        
        .search-input {
            width: 100%;
            padding: 10px 40px 10px 12px;
            border: 1px solid #fbcfe8;
            border-radius: 8px;
            font-size: 14px;
            background: #fdf2f8;
            transition: all 0.3s;
        }
        
        .search-input:focus {
            outline: none;
            border-color: #db2777;
            box-shadow: 0 0 0 3px rgba(219, 39, 119, 0.1);
        }
        
        .search-icon {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #db2777;
            font-size: 16px;
        }
        
        .search-results-info {
            margin-top: 8px;
            font-size: 12px;
            color: #9d174d;
            font-weight: 500;
        }
        
        .categories {
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .category-btn {
            padding: 10px 15px;
            background: #fdf2f8;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
            color: #db2777;
            font-size: 14px;
        }
        
        .category-btn.active {
            background: #db2777;
            color: white;
        }
        
        .category-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(219, 39, 119, 0.2);
        }
        
        .menu-container {
            overflow-y: auto;
            flex: 1;
            padding-right: 5px;
            min-height: 300px;
        }
        
        .menu-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 12px;
        }
        
        .menu-item {
            background: #fdf2f8;
            border-radius: 10px;
            padding: 12px;
            text-align: center;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            min-height: 180px;
            border: 1px solid #fbcfe8;
            position: relative;
            overflow: hidden;
        }
        
        .menu-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(219, 39, 119, 0.15);
            background: #fce7f3;
        }
        
        .menu-item-image {
            width: 100%;
            height: 120px;
            object-fit: cover;
            border-radius: 6px;
            margin-bottom: 8px;
        }
        
        .menu-item h3 {
            font-size: 14px;
            margin-bottom: 6px;
            color: #9d174d;
        }
        
        .menu-item p {
            color: #db2777;
            font-weight: 600;
            margin-top: auto;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .menu-item small {
            color: #be185d;
            font-size: 11px;
        }
        
        .cart-section {
            background: white;
            border-radius: 12px;
            padding: 15px;
            display: flex;
            flex-direction: column;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            overflow: hidden;
            border: 1px solid #fbcfe8;
            min-height: 500px;
        }
        
        .cart-header {
            margin-bottom: 15px;
            padding-bottom: 12px;
            border-bottom: 2px solid #fdf2f8;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .cart-items {
            margin-bottom: 15px;
            overflow-y: auto;
            flex: 1;
            min-height: 200px;
            max-height: 300px;
        }
        
        .cart-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #fdf2f8;
            flex-wrap: wrap;
            gap: 8px;
        }
        
        .cart-item-details {
            display: flex;
            flex-direction: column;
            flex: 1;
            padding-right: 8px;
            min-width: 150px;
        }
        
        .cart-item-name {
            font-weight: 500;
            display: flex;
            flex-direction: column;
            font-size: 14px;
        }
        
        .cart-item-controls {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 5px;
        }
        
        .quantity-btn {
            width: 25px;
            height: 25px;
            border-radius: 50%;
            border: none;
            background: #db2777;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }
        
        .cart-item-price {
            font-weight: 600;
            color: #db2777;
            display: flex;
            align-items: center;
            flex-direction: column;
            text-align: right;
            font-size: 14px;
        }
        
        .cart-totals {
            margin: 15px 0;
            padding: 15px;
            background: #fdf2f8;
            border-radius: 10px;
        }
        
        .total-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 14px;
        }
        
        .total-final {
            font-weight: bold;
            font-size: 18px;
            margin-top: 12px;
            padding-top: 12px;
            border-top: 2px solid #fbcfe8;
            color: #9d174d;
        }
        
        .pay-btn {
            width: 100%;
            padding: 15px;
            background: #db2777;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: background 0.3s;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
        }
        
        .pay-btn:hover {
            background: #be185d;
        }
        
        .notes-section {
            margin-top: 15px;
        }
        
        textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #fbcfe8;
            border-radius: 10px;
            resize: vertical;
            min-height: 80px;
            margin-top: 8px;
            background: #fdf2f8;
            font-size: 14px;
        }
        
        .empty-cart {
            text-align: center;
            color: #888;
            padding: 20px 0;
        }
        
        .empty-cart i {
            font-size: 32px;
            margin-bottom: 10px;
            color: #fbcfe8;
        }
        
        .discount-section {
            margin: 12px 0;
            padding: 12px;
            background: #f0f9ff;
            border-radius: 8px;
            border: 1px solid #bae6fd;
        }
        
        .discount-controls {
            display: flex;
            gap: 8px;
            margin-bottom: 8px;
            flex-wrap: wrap;
        }
        
        .discount-input {
            flex: 1;
            padding: 8px;
            border: 1px solid #bae6fd;
            border-radius: 6px;
            font-size: 14px;
            min-width: 120px;
        }
        
        .discount-type {
            padding: 8px;
            border: 1px solid #bae6fd;
            border-radius: 6px;
            background: white;
            font-size: 14px;
        }
        
        .discount-buttons {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }
        
        .apply-discount-btn {
            flex: 1;
            padding: 8px;
            background: #0ea5e9;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            font-size: 14px;
            min-width: 120px;
        }
        
        .apply-discount-btn:hover {
            background: #0284c7;
        }
        
        .remove-discount-btn {
            flex: 1;
            padding: 8px;
            background: #f3f4f6;
            color: #4b5563;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            font-size: 14px;
            min-width: 120px;
        }
        
        .remove-discount-btn:hover {
            background: #e5e7eb;
        }
        
        .discount-applied {
            color: #0ea5e9;
            font-weight: 600;
            text-align: center;
            padding: 5px;
            background: #e0f2fe;
            border-radius: 5px;
            margin-top: 5px;
            font-size: 14px;
        }
        
        .customization-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .customization-modal {
            background: white;
            border-radius: 12px;
            width: 450px;
            max-width: 90%;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .customization-modal-header {
            margin-bottom: 20px;
            text-align: center;
            color: #9d174d;
        }
        
        .customization-section {
            margin-bottom: 20px;
        }
        
        .customization-title {
            font-weight: 600;
            margin-bottom: 10px;
            color: #9d174d;
        }
        
        .sugar-options, .topping-options {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .sugar-option, .topping-option {
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            padding: 10px;
            border-radius: 8px;
            transition: background 0.3s;
            width: 30%;
            margin-bottom: 10px;
        }
        
        .sugar-option:hover, .topping-option:hover {
            background: #fdf2f8;
        }
        
        .sugar-option.selected, .topping-option.selected {
            background: #fce7f3;
            border: 1px solid #f9a8d4;
        }
        
        .sugar-percentage, .topping-name {
            font-size: 16px;
            font-weight: 500;
            margin-bottom: 5px;
        }
        
        .sugar-label, .topping-price {
            font-size: 12px;
            color: #666;
        }
        
        .modal-buttons {
            display: flex;
            gap: 10px;
            padding: 15px 20px 20px;
        }
        
        .modal-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .confirm-btn {
            background: #db2777;
            color: white;
        }
        
        .confirm-btn:hover {
            background: #be185d;
        }
        
        .cancel-btn {
            background: #f3f4f6;
            color: #4b5563;
        }
        
        .cancel-btn:hover {
            background: #e5e7eb;
        }
        
        .reports-section {
            display: none;
            padding: 20px;
            flex: 1;
            overflow-y: auto;
        }
        
        .reports-section.active {
            display: block;
        }
        
        .report-controls {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .report-control {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .report-control label {
            font-weight: 500;
            color: #9d174d;
        }
        
        .report-control select, .report-control input {
            padding: 10px 15px;
            border: 1px solid #fbcfe8;
            border-radius: 8px;
            background: #fdf2f8;
        }
        
        .clear-history-btn {
            padding: 10px 20px;
            background: #ef4444;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            align-self: flex-end;
        }
        
        .clear-history-btn:hover {
            background: #dc2626;
        }
        
        .report-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .summary-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.08);
            border: 1px solid #fbcfe8;
        }
        
        .summary-card h3 {
            font-size: 16px;
            color: #9d174d;
            margin-bottom: 10px;
        }
        
        .summary-card .value {
            font-size: 24px;
            font-weight: bold;
            color: #db2777;
        }
        
        .chart-container {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.08);
            border: 1px solid #fbcfe8;
        }
        
        .chart-title {
            font-size: 18px;
            color: #9d174d;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .orders-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.08);
            margin-bottom: 20px;
        }
        
        .orders-table th, .orders-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #fdf2f8;
        }
        
        .orders-table th {
            background: #fce7f3;
            color: #9d174d;
            font-weight: 600;
        }
        
        .orders-table tr:hover {
            background: #fdf2f8;
        }
        
        .no-orders {
            text-align: center;
            padding: 30px;
            color: #888;
        }
        
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .receipt-modal {
            background: white;
            border-radius: 12px;
            width: 400px;
            max-width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .receipt-header {
            background: linear-gradient(135deg, #db2777 0%, #ec4899 100%);
            color: white;
            padding: 20px;
            text-align: center;
            border-top-left-radius: 12px;
            border-top-right-radius: 12px;
            font-family: 'Khmer OS', 'Moul', sans-serif;
        }
        
        .receipt-body {
            padding: 20px;
        }
        
        .receipt-info {
            margin-bottom: 20px;
            text-align: center;
            border-bottom: 1px dashed #ddd;
            padding-bottom: 15px;
        }
        
        .receipt-items {
            margin-bottom: 15px;
            width: 100%;
        }
        
        .receipt-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            width: 100%;
        }
        
        .receipt-item-details {
            flex: 1;
        }
        
        .receipt-sugar, .receipt-topping {
            font-size: 12px;
            color: #666;
        }
        
        .receipt-totals {
            border-top: 1px dashed #ddd;
            padding-top: 15px;
            margin-bottom: 15px;
            margin-top: 15px;
        }
        
        .receipt-total-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }
        
        .receipt-footer {
            text-align: center;
            color: #888;
            font-size: 14px;
            padding: 15px 0;
            border-top: 1px dashed #ddd;
        }
        
        .receipt-buttons {
            display: flex;
            gap: 10px;
            padding: 15px 20px 20px;
        }
        
        .print-btn, .close-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
        }
        
        .print-btn {
            background: #db2777;
            color: white;
        }
        
        .print-btn:hover {
            background: #be185d;
        }
        
        .close-btn {
            background: #f3f4f6;
            color: #4b5563;
        }
        
        .close-btn:hover {
            background: #e5e7eb;
        }
        
        .language-toggle {
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(255, 255, 255, 0.2);
            padding: 6px 12px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .language-toggle:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        .language-flag {
            font-size: 16px;
        }
        
        .khmer-price {
            font-family: 'Khmer OS', 'Moul', sans-serif;
            font-size: 16px;
            font-weight: bold;
            color: #9d174d;
            margin-top: 5px;
        }
        
        .khmer-price-receipt {
            font-family: 'Khmer OS', 'Moul', sans-serif;
            font-size: 14px;
            font-weight: bold;
            color: #9d174d;
        }
        
        .khmer-total {
            font-family: 'Khmer OS', 'Moul', sans-serif;
            font-weight: bold;
            font-size: 16px;
        }
        
        .usd-price {
            font-size: 14px;
            color: #be185d;
        }
        
        .receipt-item-price {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
        }
        
        .price-toggle {
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(255, 255, 255, 0.2);
            padding: 6px 12px;
            border-radius: 20px;
            cursor: pointer;
            white-space: nowrap;
            font-size: 14px;
        }
        
        .price-toggle:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        .discount-row {
            color: #0ea5e9;
            font-weight: 600;
        }
        
        .printer-config-modal {
            background: white;
            border-radius: 12px;
            width: 500px;
            max-width: 90%;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .printer-config-section {
            margin-bottom: 20px;
        }
        
        .printer-config-title {
            font-weight: 600;
            margin-bottom: 10px;
            color: #9d174d;
        }
        
        .printer-input {
            width: 100%;
            padding: 12px;
            border: 1px solid #fbcfe8;
            border-radius: 8px;
            margin-bottom: 10px;
            font-size: 14px;
        }
        
        .printer-test-btn {
            padding: 10px 15px;
            background: #0ea5e9;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            margin-right: 10px;
        }
        
        .printer-test-btn:hover {
            background: #0284c7;
        }
        
        .printer-status {
            margin-top: 10px;
            padding: 10px;
            border-radius: 5px;
            font-weight: 500;
        }
        
        .printer-status.success {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #a7f3d0;
        }
        
        .printer-status.error {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #fca5a5;
        }
        
        .printer-help {
            background: #f0f9ff;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            font-size: 14px;
            border-left: 4px solid #0ea5e9;
        }
        
        .printer-help h4 {
            margin-bottom: 8px;
            color: #0c4a6e;
        }
        
        .printer-help ol {
            margin-left: 20px;
        }
        
        .printer-help li {
            margin-bottom: 5px;
        }

        .printer-config-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(255, 255, 255, 0.2);
            padding: 6px 12px;
            border-radius: 20px;
            cursor: pointer;
            white-space: nowrap;
            border: none;
            color: white;
            font-size: 14px;
        }
        
        .printer-config-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        .global-status {
            padding: 10px 20px;
            text-align: center;
            font-weight: 500;
            border-bottom: 1px solid #fbcfe8;
        }
        
        .global-status.success {
            background: #d1fae5;
            color: #065f46;
        }
        
        .global-status.error {
            background: #fee2e2;
            color: #991b1b;
        }
        
        .global-status.info {
            background: #dbeafe;
            color: #1e40af;
        }
        
        /* Add styles for Excel export buttons */
        .excel-export-btn {
            padding: 10px 20px;
            background: #0d9488;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .excel-export-btn:hover {
            background: #0f766e;
        }
        
        .excel-export-btn.detailed {
            background: #059669;
        }
        
        .excel-export-btn.detailed:hover {
            background: #047857;
        }
        
        .report-buttons {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }

        /* Add Product Button Styles */
        .add-product-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(255, 255, 255, 0.2);
            padding: 6px 12px;
            border-radius: 20px;
            cursor: pointer;
            white-space: nowrap;
            border: none;
            color: white;
            font-size: 14px;
        }
        
        .add-product-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* Product Manager Modal Styles */
        .product-manager-modal {
            background: white;
            border-radius: 12px;
            width: 500px;
            max-width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .product-form {
            padding: 20px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #9d174d;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #fbcfe8;
            border-radius: 8px;
            font-size: 14px;
            background: #fdf2f8;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #db2777;
            box-shadow: 0 0 0 3px rgba(219, 39, 119, 0.1);
        }

        .form-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .save-btn {
            flex: 1;
            padding: 12px;
            background: #db2777;
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
        }

        .save-btn:hover {
            background: #be185d;
        }

        .cancel-btn {
            flex: 1;
            padding: 12px;
            background: #f3f4f6;
            color: #4b5563;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
        }

        .cancel-btn:hover {
            background: #e5e7eb;
        }

        .product-list {
            margin-top: 20px;
            max-height: 300px;
            overflow-y: auto;
        }

        .product-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #fdf2f8;
        }

        .product-item:last-child {
            border-bottom: none;
        }

        .product-info h4 {
            margin: 0;
            color: #9d174d;
            font-size: 14px;
        }

        .product-info p {
            margin: 2px 0;
            font-size: 12px;
            color: #666;
        }

        .product-actions {
            display: flex;
            gap: 5px;
        }

        .edit-btn, .delete-btn {
            padding: 5px 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
        }

        .edit-btn {
            background: #0ea5e9;
            color: white;
        }

        .edit-btn:hover {
            background: #0284c7;
        }

        .delete-btn {
            background: #ef4444;
            color: white;
        }

        .delete-btn:hover {
            background: #dc2626;
        }
        
        @media print {
            body * {
                visibility: hidden;
                margin: 0 !important;
                padding: 0 !important;
            }
            
            .receipt-modal, 
            .receipt-modal * {
                visibility: visible;
            }
            
            .receipt-modal {
                position: absolute !important;
                left: 0 !important;
                top: 0 !important;
                width: 80mm !important;
                max-width: 80mm !important;
                min-width: 80mm !important;
                height: auto !important;
                margin: 0 !important;
                padding: 0 !important;
                box-shadow: none !important;
                border: none !important;
                border-radius: 0 !important;
                font-size: 12px !important;
                line-height: 1.2 !important;
            }
            
            .receipt-header {
                padding: 10px !important;
                font-size: 14px !important;
            }
            
            .receipt-body {
                padding: 10px !important;
            }
            
            .receipt-info {
                margin-bottom: 10px !important;
                padding-bottom: 8px !important;
                font-size: 11px !important;
            }
            
            .receipt-item {
                margin-bottom: 5px !important;
                font-size: 11px !important;
            }
            
            .receipt-sugar, .receipt-topping {
                font-size: 10px !important;
            }
            
            .receipt-totals {
                padding-top: 8px !important;
                margin: 10px 0 !important;
            }
            
            .receipt-footer {
                padding: 10px 0 !important;
                font-size: 11px !important;
            }
            
            .receipt-buttons,
            .no-print {
                display: none !important;
            }
            
            .receipt-item-details,
            .receipt-item-price {
                font-family: 'Courier New', monospace !important;
            }
            
            page-break-inside: avoid;
        }
        
        /* ===== MOBILE RESPONSIVE FIXES ===== */
        @media (max-width: 768px) {
            body {
                padding: 5px;
            }
            
            .dashboard {
                height: auto;
                min-height: 100vh;
                border-radius: 12px;
            }
            
            header {
                padding: 10px 15px;
                flex-direction: column;
                gap: 10px;
            }
            
            .logo {
                font-size: 20px;
                justify-content: center;
            }
            
            .header-controls {
                width: 100%;
                justify-content: space-between;
                flex-wrap: nowrap;
                overflow-x: auto;
                padding: 5px 0;
            }
            
            .language-toggle,
            .price-toggle,
            .printer-config-btn,
            .add-product-btn {
                flex-shrink: 0;
                margin: 0 2px;
                font-size: 12px;
                padding: 5px 10px;
            }
            
            .user-info {
                font-size: 12px;
                padding: 5px 10px;
            }
            
            .avatar {
                width: 30px;
                height: 30px;
                font-size: 12px;
            }
            
            .nav-tabs {
                overflow-x: auto;
                flex-wrap: nowrap;
            }
            
            .nav-tab {
                min-width: 120px;
                padding: 10px 15px;
                font-size: 13px;
                white-space: nowrap;
            }
            
            .slider-container {
                height: 100px;
            }
            
            .main-content {
                grid-template-columns: 1fr;
                gap: 10px;
                padding: 10px;
                overflow: visible;
            }
            
            .order-section,
            .cart-section {
                min-height: auto;
                padding: 12px;
            }
            
            .menu-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 8px;
            }
            
            .menu-item {
                min-height: 150px;
                padding: 8px;
            }
            
            .menu-item-image {
                height: 80px;
            }
            
            .menu-item h3 {
                font-size: 12px;
            }
            
            .menu-item small {
                font-size: 10px;
            }
            
            .cart-items {
                max-height: 200px;
            }
            
            .cart-item {
                font-size: 12px;
            }
            
            .search-input {
                font-size: 14px;
                padding: 8px 35px 8px 10px;
            }
            
            .category-btn {
                padding: 8px 12px;
                font-size: 12px;
            }
            
            .pay-btn {
                padding: 12px;
                font-size: 14px;
            }
            
            /* Fix modal sizes for mobile */
            .customization-modal,
            .receipt-modal,
            .printer-config-modal,
            .product-manager-modal {
                width: 95% !important;
                margin: 10px;
            }
            
            .sugar-options,
            .topping-options {
                justify-content: center;
            }
            
            .sugar-option,
            .topping-option {
                width: 45%;
                margin: 5px;
            }

            .form-actions {
                flex-direction: column;
            }
        }
        
        @media (max-width: 480px) {
            .menu-grid {
                grid-template-columns: 1fr;
            }
            
            .menu-item {
                min-height: 140px;
            }
            
            .menu-item-image {
                height: 70px;
            }
            
            .header-controls {
                flex-direction: column;
                gap: 5px;
            }
            
            .language-toggle,
            .price-toggle,
            .printer-config-btn,
            .add-product-btn {
                width: 100%;
                justify-content: center;
                margin: 2px 0;
            }
            
            .cart-item {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .cart-item-price {
                align-self: flex-end;
            }
        }
        
        @media (min-width: 769px) and (max-width: 1024px) {
            .menu-grid {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .main-content {
                grid-template-columns: 2fr 1fr;
            }
        }
        
        /* Ensure scrolling works properly */
        .menu-container,
        .cart-items,
        .reports-section {
            -webkit-overflow-scrolling: touch;
            scrollbar-width: thin;
        }
        
        ::-webkit-scrollbar {
            width: 6px;
        }
        
        ::-webkit-scrollbar-track {
            background: #fdf2f8;
            border-radius: 8px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #fbcfe8;
            border-radius: 8px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #f9a8d4;
        }
        
        /* NEW STYLES FOR PRINTING */
        .print-status-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }
        
        .print-status-modal {
            background: white;
            border-radius: 12px;
            padding: 30px;
            text-align: center;
            max-width: 400px;
            width: 90%;
        }
        
        .print-status-icon {
            font-size: 48px;
            margin-bottom: 20px;
        }
        
        .print-status-icon.success {
            color: #10b981;
        }
        
        .print-status-icon.error {
            color: #ef4444;
        }
        
        .print-status-icon.info {
            color: #3b82f6;
        }
        
        .print-status-message {
            font-size: 16px;
            margin-bottom: 20px;
            color: #333;
        }
        
        .print-retry-btn {
            padding: 10px 20px;
            background: #db2777;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            margin: 5px;
        }
        
        .print-fallback-btn {
            padding: 10px 20px;
            background: #6b7280;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            margin: 5px;
        }
        
        .print-close-btn {
            padding: 10px 20px;
            background: #f3f4f6;
            color: #4b5563;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            margin: 5px;
        }
        
        .usb-permission-request {
            background: #e0f2fe;
            border-left: 4px solid #0ea5e9;
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
        }
        
        .usb-permission-request h4 {
            color: #0c4a6e;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .usb-permission-btn {
            background: #0ea5e9;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            margin-top: 10px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .usb-permission-btn:hover {
            background: #0284c7;
        }
        
        .platform-info {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 10px 20px;
            text-align: center;
            font-size: 14px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .platform-info.hidden {
            display: none;
        }
        
        .platform-info i {
            font-size: 18px;
        }
        
        .platform-tag {
            background: rgba(255, 255, 255, 0.2);
            padding: 4px 12px;
            border-radius: 20px;
            font-weight: 500;
        }
        
        @media (max-width: 768px) {
            .platform-info {
                font-size: 12px;
                padding: 8px 15px;
            }
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Moul&display=swap" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Hanuman:wght@300;400;700&display=swap');
        .khmer-font {
            font-family: 'Hanuman', serif;
        }
    </style>
</head>
<body>
    <!-- Login Page -->
    <div id="loginPage" class="login-page">
        <div class="login-container">
            <div class="login-logo">
                <h1>
                    <i class="fas fa-crown"></i>
                    Royal Tea&Cafe
                </h1>
                <div class="subtitle">POS System Login</div>
            </div>

            <form id="loginForm">
                <div class="login-form-group">
                    <label for="username">Username</label>
                    <input type="text" id="username" placeholder="Enter your username" required>
                </div>

                <div class="login-form-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" placeholder="Enter your password" required>
                </div>

                <button type="submit" class="login-btn">Login to POS</button>

                <div class="login-error-message" id="loginErrorMessage">
                    Invalid username or password
                </div>

                <!-- Demo credentials for testing -->
                <div class="login-demo-credentials">
                    <h4>Demo Credentials:</h4>
                    <div>
                        <strong>Admin:</strong> admin / password123 
                        <span class="user-role-badge admin">Admin</span>
                    </div>
                    <div>
                        <strong>Staff:</strong> staff / staff123 
                        <span class="user-role-badge staff">Staff</span>
                    </div>
                    <div style="margin-top: 8px; font-size: 11px; color: #888;">
                        <strong>Note:</strong> Staff accounts cannot access reports or clear history
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- POS Dashboard (Initially Hidden) -->
    <div id="posDashboard" class="hidden">
        <div id="root"></div>
    </div>

    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script type="text/babel">
        // ==================== PRINTING FIXES ====================
        
        // Platform detection utility
        const detectPlatform = () => {
            const userAgent = navigator.userAgent;
            const isIOS = /iPad|iPhone|iPod/.test(userAgent) && !window.MSStream;
            const isAndroid = /Android/.test(userAgent);
            const isChrome = /Chrome/.test(userAgent) && !/Edge/.test(userAgent);
            const supportsWebUSB = 'usb' in navigator && isChrome && !isIOS;
            
            return {
                isIOS,
                isAndroid,
                isDesktop: !isAndroid && !isIOS,
                supportsWebUSB,
                browser: isChrome ? 'Chrome' : /Safari/.test(userAgent) ? 'Safari' : 'Other',
                isMobile: isAndroid || isIOS
            };
        };
        
        // ESC/POS command generator for Star TSP100III printer
        const generateEscPosCommands = (receiptData, language) => {
            const encoder = new TextEncoder();
            let commands = [];
            
            // Initialize printer
            commands.push(0x1B, 0x40); // ESC @ - Initialize
            
            // Title (centered, double height/width)
            commands.push(0x1B, 0x61, 0x01); // Center align
            commands.push(0x1D, 0x21, 0x11); // Double height & width
            commands.push(...encoder.encode("ROYAL TEA & CAFE\n"));
            commands.push(0x1D, 0x21, 0x00); // Normal text
            commands.push(0x1B, 0x61, 0x00); // Left align
            
            // Receipt info
            commands.push(...encoder.encode("================================\n"));
            commands.push(0x1B, 0x21, 0x08); // Bold
            commands.push(...encoder.encode(`Order #${receiptData.orderNumber}\n`));
            commands.push(0x1B, 0x21, 0x00); // Normal
            
            commands.push(...encoder.encode(`${receiptData.date}\n`));
            commands.push(...encoder.encode(`${receiptData.time}\n`));
            commands.push(...encoder.encode("--------------------------------\n"));
            
            // Items header
            commands.push(0x1B, 0x21, 0x08); // Bold
            commands.push(...encoder.encode("Qty  Item                 Price\n"));
            commands.push(0x1B, 0x21, 0x00); // Normal
            commands.push(...encoder.encode("--------------------------------\n"));
            
            // Items
            receiptData.items.forEach(item => {
                const name = language === 'en' ? item.name : item.nameKh;
                const qty = item.quantity.toString().padStart(2);
                const price = `$${(item.price * item.quantity).toFixed(2)}`.padStart(7);
                
                // Truncate long names
                let displayName = name;
                if (displayName.length > 20) {
                    displayName = displayName.substring(0, 17) + '...';
                }
                
                const line = `${qty}x ${displayName.padEnd(20)}${price}\n`;
                commands.push(...encoder.encode(line));
                
                // Add customization info if present
                if (item.sugarLevel) {
                    commands.push(...encoder.encode(`   Sugar: ${item.sugarLevel}\n`));
                }
                if (item.topping) {
                    const toppingName = language === 'en' ? item.topping.name : item.topping.nameKh;
                    commands.push(...encoder.encode(`   Topping: ${toppingName}\n`));
                }
            });
            
            // Totals
            commands.push(...encoder.encode("--------------------------------\n"));
            commands.push(...encoder.encode(`Subtotal: $${receiptData.subtotal.toFixed(2)}\n`));
            
            if (receiptData.discount > 0) {
                commands.push(...encoder.encode(`Discount: -$${receiptData.discount.toFixed(2)}\n`));
            }
            
            commands.push(0x1B, 0x21, 0x10); // Bold + double height
            commands.push(...encoder.encode(`TOTAL: $${receiptData.total.toFixed(2)}\n`));
            commands.push(0x1B, 0x21, 0x00); // Normal
            
            // Footer
            commands.push(...encoder.encode("================================\n"));
            commands.push(0x1B, 0x61, 0x01); // Center align
            commands.push(...encoder.encode("Thank you for your visit!\n"));
            commands.push(...encoder.encode("Please come again\n\n\n"));
            commands.push(0x1B, 0x61, 0x00); // Left align
            
            // Add cashier info if available
            if (receiptData.cashier) {
                commands.push(...encoder.encode(`Cashier: ${receiptData.cashier}\n`));
            }
            
            // Cut paper (partial cut)
            commands.push(0x1D, 0x56, 0x41, 0x10); // GS V 41 10 - Partial cut
            
            return new Uint8Array(commands);
        };
        
        // WebUSB printing function
        const printViaWebUSB = async (receiptData, language) => {
            try {
                console.log('Starting WebUSB print...');
                
                // Request USB device (Star Micronics vendor ID: 0x0519)
                const device = await navigator.usb.requestDevice({ 
                    filters: [{ vendorId: 0x0519 }] 
                }).catch(err => {
                    console.log('User cancelled device selection');
                    throw new Error('No printer selected');
                });
                
                console.log('Device selected:', device);
                
                await device.open();
                await device.selectConfiguration(1);
                await device.claimInterface(0);
                
                // Generate ESC/POS commands
                const escposData = generateEscPosCommands(receiptData, language);
                
                // Send to printer
                await device.transferOut(1, escposData);
                
                // Close connection
                await device.close();
                
                console.log('Print successful via WebUSB');
                return { success: true, message: 'Receipt printed successfully!' };
            } catch (error) {
                console.error('WebUSB print error:', error);
                return { 
                    success: false, 
                    message: error.message || 'Failed to print via USB. Please check printer connection.'
                };
            }
        };
        
        // Network printing function
        const printViaNetwork = async (receiptData, language, printerSettings) => {
            try {
                if (!printerSettings.ipAddress) {
                    throw new Error('No printer IP configured');
                }
                
                // Generate ESC/POS commands
                const escposData = generateEscPosCommands(receiptData, language);
                
                // Convert to ArrayBuffer for network transmission
                const arrayBuffer = escposData.buffer;
                
                // Try to send via fetch with proper headers
                try {
                    const response = await fetch(`http://${printerSettings.ipAddress}:${printerSettings.port || 80}`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/octet-stream'
                        },
                        body: arrayBuffer,
                        mode: 'no-cors' // Important for cross-origin requests
                    });
                    
                    // With no-cors mode, we can't check response status
                    // If we get here without error, assume success
                    return { success: true, message: 'Receipt sent to network printer!' };
                } catch (fetchError) {
                    console.log('Fetch failed, trying alternative method...');
                    
                    // Alternative: Create a form submission (works with some print servers)
                    const form = document.createElement('form');
                    form.method = 'POST';
                    form.action = `http://${printerSettings.ipAddress}:${printerSettings.port || 80}`;
                    form.enctype = 'application/octet-stream';
                    
                    const input = document.createElement('input');
                    input.type = 'hidden';
                    input.name = 'data';
                    // Convert to hex string
                    const hexData = Array.from(new Uint8Array(arrayBuffer))
                        .map(b => b.toString(16).padStart(2, '0'))
                        .join('');
                    input.value = hexData;
                    
                    form.appendChild(input);
                    document.body.appendChild(form);
                    form.submit();
                    document.body.removeChild(form);
                    
                    return { success: true, message: 'Receipt sent via form submission!' };
                }
            } catch (error) {
                console.error('Network print error:', error);
                return { 
                    success: false, 
                    message: 'Failed to connect to network printer. Check IP address and network connection.'
                };
            }
        };
        
        // Print Status Modal Component
        const PrintStatusModal = ({ status, onRetry, onFallback, onClose, language }) => {
            if (!status) return null;
            
            const t = {
                en: {
                    retry: "Retry",
                    printViaBrowser: "Print via Browser",
                    close: "Close"
                },
                km: {
                    retry: "",
                    printViaBrowser: "",
                    close: ""
                }
            }[language];
            
            return (
                <div className="print-status-overlay">
                    <div className="print-status-modal">
                        <div className={`print-status-icon ${status.success === null ? 'info' : status.success ? 'success' : 'error'}`}>
                            {status.success === null ? '' : status.success ? '' : ''}
                        </div>
                        <div className="print-status-message">{status.message}</div>
                        <div>
                            {!status.success && (
                                <button className="print-retry-btn" onClick={onRetry}>
                                    {t.retry}
                                </button>
                            )}
                            {!status.success && (
                                <button className="print-fallback-btn" onClick={onFallback}>
                                    {t.printViaBrowser}
                                </button>
                            )}
                            <button className="print-close-btn" onClick={onClose}>
                                {t.close}
                            </button>
                        </div>
                    </div>
                </div>
            );
        };
        
        // USB Permission Request Component
        const USBPermissionRequest = ({ onRequest, language }) => {
            const platform = detectPlatform();
            
            if (!platform.supportsWebUSB || platform.isIOS) return null;
            
            const t = {
                en: {
                    usbPrinterSetup: "USB Printer Setup",
                    usbSetupInstructions: "Connect your Star TSP100III printer via USB cable and click below to grant permission.",
                    grantUsbPermission: "Grant USB Permission"
                },
                km: {
                    usbPrinterSetup: " USB",
                    usbSetupInstructions: " Star TSP100III  cable USB ",
                    grantUsbPermission: " USB"
                }
            }[language];
            
            return (
                <div className="usb-permission-request">
                    <h4>
                        <i className="fas fa-print"></i>
                        {t.usbPrinterSetup}
                    </h4>
                    <p>{t.usbSetupInstructions}</p>
                    <button className="usb-permission-btn" onClick={onRequest}>
                        <i className="fas fa-plug"></i>
                        {t.grantUsbPermission}
                    </button>
                </div>
            );
        };
        
        // Platform Info Banner Component
        const PlatformInfoBanner = ({ platform, language, onHide }) => {
            if (!platform.isMobile) return null;
            
            const t = {
                en: {
                    ipadMessage: 'iPad detected: Use Network Printer in settings for best results',
                    androidMessage: 'Android device: USB printing available. Connect your printer via USB cable.',
                    close: 'Close'
                },
                km: {
                    ipadMessage: 'iPad  ',
                    androidMessage: ' Android  USB   cable USB',
                    close: ''
                }
            }[language];
            
            const getPlatformMessage = () => {
                if (platform.isIOS) {
                    return t.ipadMessage;
                } else if (platform.isAndroid) {
                    return t.androidMessage;
                }
                return '';
            };
            
            return (
                <div className="platform-info">
                    <i className="fas fa-info-circle"></i>
                    <span>{getPlatformMessage()}</span>
                    <span className="platform-tag">
                        {platform.isIOS ? 'iPad' : platform.isAndroid ? 'Android' : 'Desktop'}
                    </span>
                    <button 
                        onClick={onHide}
                        style={{
                            background: 'transparent',
                            border: 'none',
                            color: 'white',
                            cursor: 'pointer',
                            marginLeft: '10px'
                        }}
                        title={t.close}
                    >
                        <i className="fas fa-times"></i>
                    </button>
                </div>
            );
        };
        
        // ==================== YOUR ORIGINAL POS CODE ====================
        
        // Login functionality
        let currentUser = null;

        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const errorMessage = document.getElementById('loginErrorMessage');

            // User authentication
            const users = {
                'admin': { password: 'password123', role: 'admin', displayName: 'Kimrong Leng' },
                'staff': { password: 'staff123', role: 'staff', displayName: 'Staff Member' }
            };

            if (users[username] && users[username].password === password) {
                // Successful login
                currentUser = users[username];
                errorMessage.style.display = 'none';
                
                // Hide login page and show POS dashboard
                document.getElementById('loginPage').classList.add('hidden');
                document.getElementById('posDashboard').classList.remove('hidden');
                
                // Initialize the POS system with user role
                initializePOS(currentUser);
            } else {
                // Failed login
                errorMessage.style.display = 'block';
            }
        });

        // Clear error message when user starts typing
        document.getElementById('username').addEventListener('input', function() {
            document.getElementById('loginErrorMessage').style.display = 'none';
        });

        document.getElementById('password').addEventListener('input', function() {
            document.getElementById('loginErrorMessage').style.display = 'none';
        });

        // POS System Code (Your existing React code)
        const { useState, useEffect, useRef } = React;

        const EXCHANGE_RATE = 4000;

        const usdToKhr = (usd) => {
            return Math.round(usd * EXCHANGE_RATE);
        };

        const formatKhrPrice = (price) => {
            return price.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",") + "";
        };

        const toppingOptions = [
            { id: 1, name: "Snow Pearls", nameKh: "", price: 0.50 },
            { id: 2, name: "Honey Jack", nameKh: "", price: 0.50 },
            { id: 3, name: "Pearls", nameKh: "", price: 0.50 },
            { id: 4, name: "Honey Jack", nameKh: "", price: 0.50 },
            { id: 5, name: "Brown Sugar Pearls", nameKh: "", price: 0.50 },
            { id: 6, name: "Cream", nameKh: "", price: 0.50 }
        ];

        // Load menu data from localStorage or use default
        const loadMenuDataFromStorage = () => {
            try {
                const savedMenuData = localStorage.getItem('royalCafeMenuData');
                if (savedMenuData) {
                    return JSON.parse(savedMenuData);
                }
            } catch (error) {
                console.error('Error loading menu data from storage:', error);
            }
            
            // Return default menu data if nothing is saved
            return {
                'HOT SALES': [
                    { id: 1, name: "Egg Coffee", nameKh: "", price: 4.50, image: "https://food-cms.grab.com/compressed_webp/items/KHITEA20250329185400870518/detail/3766b6f6eaba4891bebd9fde7141dac0_1743326057978577924.webp" },
                    { id: 2, name: "Mocha", nameKh: "", price: 4.00, image: "https://food-cms.grab.com/compressed_webp/items/KHITEA20250329185400210346/detail/98bc89b6cead43d68aa8ee8d568e6702_1743326057925986955.webp" },
                    { id: 3, name: "Coffee Latte", nameKh: "", price: 3.75, image: "https://food-cms.grab.com/compressed_webp/items/KHITEA20250329185400132834/detail/61f42574637c43b5b43917866acf5c96_1743326058008760193.webp" },
                    { id: 4, name: "Cappuccino", nameKh: "", price: 3.75, image: "https://food-cms.grab.com/compressed_webp/items/KHITEA20250329185401215610/detail/8fde6a9b8d7b408c9dd68a31a3e9f2f7_1743326058071300227.webp" },
                    { id: 5, name: "Coconut Cream Latte", nameKh: "", price: 4.25, image: "https://food-cms.grab.com/compressed_webp/items/KHITEA20250329185404772720/detail/8802d46d398e4a4fa029bed3d7285d07_1743326058048061389.webp" },
                    { id: 6, name: "Passion Cream", nameKh: "", price: 4.50, image: "https://food-cms.grab.com/compressed_webp/items/KHITEA20250329185401004116/detail/a9c41dfc878a430e970b392cc7a99313_1743326058107158839.webp" }
                ],
                'COFFEE': [
                    { id: 7, name: "Ice Espresso", nameKh: "", price: 3.50, image: "https://food-cms.grab.com/compressed_webp/items/KHITEA20250329185401373335/detail/3750a0778b6f47fc8d887bb47ebcb6c7_1743326058114571174.webp" },
                    { id: 8, name: "Americano", nameKh: "", price: 3.00, image: "https://food-cms.grab.com/compressed_webp/items/KHITEA20250329185405444913/detail/c7259d977999409180313c4a4781bfbc_1743326058146738458.webp" },
                    { id: 9, name: "Black Coffee Honey", nameKh: "", price: 3.25, image: "https://food-cms.grab.com/compressed_webp/items/KHITEA20250329185405908813/detail/8190dc78882a4766994d6d95500f3586_1743326058132293382.webp" },
                    { id: 10, name: "Vanilla Latte", nameKh: " ", price: 4.00, image: "https://food-cms.grab.com/compressed_webp/items/KHITEA20250329185400228558/detail/8cfda4aeb8d34679a1e3d742bdeeeaba_1743326057976112967.webp" },
                    { id: 11, name: "Caramel Latte", nameKh: "", price: 4.25, image: "https://food-cms.grab.com/compressed_webp/items/KHITEA20250329185400829807/detail/3d0eb53d114b410eb3f2a2c6a342577b_1743326058078583691.webp" },
                    { id: 12, name: "Coconut Coffee", nameKh: "", price: 4.00, image: "https://food-cms.grab.com/compressed_webp/items/KHITEA20250329185400228558/detail/8cfda4aeb8d34679a1e3d742bdeeeaba_1743326057976112967.webp" }
                ],
                'FRAPPE': [
                    { id: 13, name: "Mocha Frappe", nameKh: "", price: 4.75, image: "https://food-cms.grab.com/compressed_webp/items/KHITEA20250329185401043515/detail/d7286edd68a14244a8dffa550d3ac2f5_1743326058058727555.webp" },
                    { id: 14, name: "Vanilla Latte Frappe", nameKh: "", price: 4.50, image: "https://food-cms.grab.com/compressed_webp/items/KHITEA20250329185403715221/detail/fbe160a73a144de58a267da820aee2c5_1743326058119121945.webp" },
                    { id: 15, name: "Cappuccino Frappe", nameKh: "", price: 4.50, image: "https://food-cms.grab.com/compressed_webp/items/KHITEA20250329185400610134/detail/ff9dd6f2b2714392877bef3bc7feced3_1743326057952816904.webp" },
                    { id: 16, name: "Chocolate Frappe", nameKh: "", price: 4.75, image: "https://food-cms.grab.com/compressed_webp/items/KHITEA20250329185400269375/detail/b20206f65b9b45d9a49accaf4d31e86a_1743326057932335748.webp" },
                    { id: 17, name: "Passion Frappe", nameKh: "", price: 4.75, image: "https://food-cms.grab.com/compressed_webp/items/KHITEA20250329185401855399/detail/c57c00e931424aa7947abb2e39b91b78_1743326058048819293.webp" },
                    { id: 18, name: "Coconut Frappe", nameKh: "", price: 4.50, image: "https://food-cms.grab.com/compressed_webp/items/KHITEA20250329185401753605/detail/396077381c8b43558553facbcdf72286_1743326058063252425.webp" },
                    { id: 19, name: "Strawberry Frappe", nameKh: "", price: 4.75, image: "https://food-cms.grab.com/compressed_webp/items/KHITEA20250329185401053436/detail/5b9c1bafada84b70afb2cffca88ab320_1743326058042938921.webp" },
                    { id: 20, name: "Matcha Frappe", nameKh: "", price: 4.75, image: "https://food-cms.grab.com/compressed_webp/items/KHITEA20250329185359765196/detail/62f16176507040d5a4051bce874ac90e_1743326057976521543.webp" }
                ],
                'MILK TEA': [
                    { id: 21, name: "Royal Milk Tea", nameKh: "", price: 3.75, image: "https://food-cms.grab.com/compressed_webp/items/KHITEA20250329185400829807/detail/3d0eb53d114b410eb3f2a2c6a342577b_1743326058078583691.webp" },
                    { id: 22, name: "Taro Milk", nameKh: "", price: 4.00, image: "https://food-cms.grab.com/compressed_webp/items/KHITEA20250329185405940563/detail/cd68cadf892544898a4d1d6a95b509d4_1743326058145277322.webp" },
                    { id: 23, name: "Milk Green Tea", nameKh: "", price: 3.75, image: "https://food-cms.grab.com/compressed_webp/items/KHITEA20250329185402136970/detail/b9d904e4eec04a01abf7a9e5cd6787e5_1743326058085453833.webp" },
                    { id: 24, name: "Red Milk Tea", nameKh: "", price: 3.75, image: "https://food-cms.grab.com/compressed_webp/items/KHITEA20250329185400187186/detail/b0420ef3da034cf0b6de4a9d7ff6e3e4_1743326057982204968.webp" },
                    { id: 25, name: "Vanilla Milk Tea", nameKh: "", price: 4.00, image: "https://food-cms.grab.com/compressed_webp/items/KHITEA20250329185359876051/detail/e7a6ffc5639142a5bc10ae4a5ddc6f1e_1743326057945430031.webp" },
                    { id: 26, name: "Strawberry Milk Tea", nameKh: "", price: 4.25, image: "https://food-cms.grab.com/compressed_webp/items/KHITEA20250329185401216576/detail/f6a130b169864292bc910e8434471df1_1743326058039113241.webp" },
                    { id: 27, name: "Honey Milk Tea", nameKh: "", price: 4.00, image: "https://food-cms.grab.com/compressed_webp/items/KHITEA20250329185400502448/detail/8413990edca149d0b4731e472daada7b_1743326057978493320.webp" },
                    { id: 28, name: "Cocao", nameKh: "", price: 3.50, image: "https://food-cms.grab.com/compressed_webp/items/KHITEA20250329185405270500/detail/610d853449d84ab385181ddb16396f51_1743326058132415260.webp" },
                    { id: 29, name: "Coffee Milk Tea", nameKh: "", price: 4.00, image: "https://food-cms.grab.com/compressed_webp/items/KHITEA20250329185405624077/detail/06b03dc8326746578be6809c29801800_1743326058162845363.webp" },
                    { id: 30, name: "Coffee Mocha", nameKh: "", price: 4.25, image: "https://food-cms.grab.com/compressed_webp/items/KHITEA20250329185400210346/detail/98bc89b6cead43d68aa8ee8d568e6702_1743326057925986955.webp" },
                    { id: 31, name: "Caramel Milk Tea", nameKh: "", price: 4.25, image: "https://food-cms.grab.com/compressed_webp/items/KHITEA20250329185400829807/detail/3d0eb53d114b410eb3f2a2c6a342577b_1743326058078583691.webp" },
                    { id: 32, name: "Melons Milk Tea", nameKh: "", price: 4.25, image: "https://food-cms.grab.com/compressed_webp/items/KHITE2025091209173772859/detail/menueditor_item_dce3c5daf36c4ee89b1f22f68d316b16_1757668609048069529.webp" }
                ],
                'OTHER': [
                    { id: 33, name: "Chocolate", nameKh: "", price: 3.75, image: "https://food-cms.grab.com/compressed_webp/items/KHITEA20250329185359855137/detail/2b565e77d29b4563b5f828714e2e96f5_1743326057994156337.webp" },
                    { id: 34, name: "Strawberry Matcha", nameKh: "", price: 4.50, image: "https://food-cms.grab.com/compressed_webp/items/KHITEA20250329185400234373/detail/039291709e5f4329ac537eaa0e75b25b_1743326057969675134.webp" },
                    { id: 35, name: "Matcha Latte", nameKh: "", price: 4.25, image: "https://food-cms.grab.com/compressed_webp/items/KHITEA20250329185359765196/detail/62f16176507040d5a4051bce874ac90e_1743326057976521543.webp" },
                    { id: 36, name: "Passion Milk", nameKh: "", price: 4.25, image: "https://food-cms.grab.com/compressed_webp/items/KHITEA20250329185401879059/detail/ecc7e669dabd4c4fa3e3aa3634e9f2bb_1743326058059963640.webp" },
                    { id: 37, name: "Cacao Fresh Milk", nameKh: "", price: 4.00, image: "https://food-cms.grab.com/compressed_webp/items/KHITEA20250329185405270500/detail/610d853449d84ab385181ddb16396f51_1743326058132415260.webp" },
                    { id: 38, name: "Strawberry Fresh Milk", nameKh: "", price: 4.25, image: "https://food-cms.grab.com/compressed_webp/items/KHITEA20250329185400234373/detail/039291709e5f4329ac537eaa0e75b25b_1743326057969675134.webp" },
                    { id: 39, name: "Royall Brown Sugar", nameKh: "", price: 4.50, image: "https://food-cms.grab.com/compressed_webp/items/KHITEA20250329185400829807/detail/3d0eb53d114b410eb3f2a2c6a342577b_1743326058078583691.webp" },
                    { id: 40, name: "Passion Fresh", nameKh: "", price: 4.25, image: "https://food-cms.grab.com/compressed_webp/items/KHITEA20250329185400906956/detail/3b559284e076434baa554296221bd0af_1743326057996569531.webp" },
                    { id: 41, name: "Honey Lemon Tea", nameKh: "", price: 3.75, image: "https://food-cms.grab.com/compressed_webp/items/KHITEA20250329185401612711/detail/e9f219da794f4da98a4ce153184625f2_1743326058040387728.webp" },
                    { id: 42, name: "Ovaltine", nameKh: "", price: 3.50, image: "https://food-cms.grab.com/compressed_webp/items/KHITE2025091209155305200/detail/menueditor_item_1186800782b54644ab9b44c6cd5b904e_1757668358086873289.webp" },
                    { id: 44, name: "Nescafe", nameKh: "", price: 3.25, image: "https://food-cms.grab.com/compressed_webp/items/KHITEA20250329185401373335/detail/3750a0778b6f47fc8d887bb47ebcb6c7_1743326058114571174.webp" },
                    { id: 45, name: "Strawberry Tea", nameKh: "", price: 3.75, image: "https://food-cms.grab.com/compressed_webp/items/KHITE2025091209200023557/detail/menueditor_item_8ac3d0f8e4fa449a941d673bf9d0517a_1757668771983774712.webp" },
                    { id: 46, name: "Lychee Tea", nameKh: "", price: 3.75, image: "https://food-cms.grab.com/compressed_webp/items/KHITE2025091209190694798/detail/menueditor_item_55fb5878a19b4453991b5b68b7bde3c7_1757668699563770244.webp" },
                    { id: 47, name: "Melon Tea", nameKh: "", price: 3.75, image: "https://food-cms.grab.com/compressed_webp/items/KHITE2025091209173772859/detail/menueditor_item_dce3c5daf36c4ee89b1f22f68d316b16_1757668609048069529.webp" }
                ],
                'SODA': [
                    { id: 48, name: "Strawberry Soda", nameKh: "", price: 3.75, image: "https://z-p3-scontent.fpnh18-3.fna.fbcdn.net/v/t39.30808-6/486288010_1112876617519234_5496247654139844088_n.jpg?stp=c194.0.1053.1053a_dst-jpg_s206x206_tt6&_nc_cat=101&ccb=1-7&_nc_sid=50ad20&_nc_eui2=AeFzMT5l8pJNbwkxvjHAFwrgJ1s3lyR1h3onWzeXJHWHeoytpedRUDutCgKLiTZRjj_0YU31Qn7eN3gbrHGmjEwx&_nc_ohc=OFtSXfRPBkUQ7kNvwFbwamG&_nc_oc=AdnLGqxH7ESdCwSPEpWDZUhuBjH3noESGp6p6jPEo6pC-Eoo9Bk123FUzK7qO23tX84&_nc_zt=23&_nc_ht=z-p3-scontent.fpnh18-3.fna&_nc_gid=FBg7f8AQS4u2bTTWEbGM0A&oh=00_AfZ68Y-fm5vlzpaX6DQez8dXfCSDMi-hB-fkA8NZs5QWEA&oe=68D4177A" },
                    { id: 49, name: "Passion Soda", nameKh: "", price: 3.75, image: "https://z-p3-scontent.fpnh18-3.fna.fbcdn.net/v/t39.30808-6/485966615_1112876004185962_8218854233391420061_n.jpg?stp=c194.0.1053.1053a_dst-jpg_s206x206_tt6&_nc_cat=106&ccb=1-7&_nc_sid=50ad20&_nc_eui2=AeHLYRvHP1imUPSZ8V8RZYbvhYmVVv06-JeFiZVW_Tr4l6AZycCZpkrpZuRW_L3DwnPT6lDuVzInJgmeKGUuDM-R&_nc_ohc=aIWOj6lO3dIQ7kNvwHyOz4t&_nc_oc=AdmADOmnwiLlCgDUCnO1_TsqsV1t1Po4CV6jhkF5deDhDYGvKpEZFZw9qWL_c2c3l7Y&_nc_zt=23&_nc_ht=z-p3-scontent.fpnh18-3.fna&_nc_gid=FBg7f8AQS4u2bTTWEbGM0A&oh=00_Afbf3rUkXS88tkYW0aagoNww7xQcDAHzMNtMQldOV-TI2A&oe=68D408AC" },
                    { id: 50, name: "Bule Hawaii Soda", nameKh: "", price: 4.00, image: "https://food-cms.grab.com/compressed_webp/items/KHITE2025091209382600762/detail/menueditor_item_61a275026c684d099ba3e6cdb0c31812_1757669883580949032.webp" },
                    { id: 51, name: "Lychee Soda", nameKh: "", price: 3.75, image: "https://food-cms.grab.com/compressed_webp/items/KHITE2025091209190694798/detail/menueditor_item_55fb5878a19b4453991b5b68b7bde3c7_1757668699563770244.webp" },
                    { id: 52, name: "Melon Soda", nameKh: "", price: 3.75, image: "https://food-cms.grab.com/compressed_webp/items/KHITE2025091209173772859/detail/menueditor_item_dce3c5daf36c4ee89b1f22f68d316b16_1757668609048069529.webp" }
                ]
            };
        };

        // Save menu data to localStorage
        const saveMenuDataToStorage = (menuData) => {
            try {
                localStorage.setItem('royalCafeMenuData', JSON.stringify(menuData));
            } catch (error) {
                console.error('Error saving menu data to storage:', error);
            }
        };

        // Initialize menu data
        let menuData = loadMenuDataFromStorage();

        // Load orders from localStorage or initialize empty array
        const loadOrdersFromStorage = () => {
            try {
                const savedOrders = localStorage.getItem('royalCafeOrders');
                return savedOrders ? JSON.parse(savedOrders) : [];
            } catch (error) {
                console.error('Error loading orders from storage:', error);
                return [];
            }
        };

        const translations = {
            en: {
                pointOfSale: "Point of Sale",
                reports: "Reports",
                hotSales: "HOT SALES",
                coffee: "COFFEE",
                frappe: "FRAPPE",
                milkTea: "MILK TEA",
                other: "OTHER",
                soda: "SODA",
                sugarLevel: "Sugar Level",
                topping: "Topping",
                snowPearls: "Snow Pearls",
                honeyJack: "Honey Jack",
                cream: "Cream",
                enterSale: "Enter Sale",
                order: "Order",
                items: "items",
                noItems: "No items in cart",
                subtotal: "Subtotal",
                total: "Total",
                pay: "Pay",
                addNotes: "Add your notes here...",
                specialInstructions: "Special instructions or notes for the order",
                customize: "Customize",
                noSugar: "No Sugar",
                light: "Light",
                mediumLight: "Medium Light",
                medium: "Medium",
                standard: "Standard",
                extra: "Extra",
                cancel: "Cancel",
                confirm: "Confirm",
                reportType: "Report Type",
                dailyReport: "Daily Report",
                monthlyReport: "Monthly Report",
                selectDate: "Select Date",
                selectMonth: "Select Month",
                totalSales: "Total Sales",
                totalOrders: "Total Orders",
                averageOrder: "Average Order",
                productsSold: "Products Sold",
                dailySalesReport: "Daily Sales Report",
                monthlySalesReport: "Monthly Sales Report",
                salesByCategory: "Sales by Category",
                orderDetails: "Order Details",
                orderId: "Order ID",
                dateTime: "Date & Time",
                status: "Status",
                noOrders: "No orders found",
                royalTeaCafe: "Royal Tea&Cafe",
                orderReceipt: "Order Receipt",
                thankYou: "Thank you for your visit!",
                comeAgain: "Please come again",
                print: "Print",
                close: "Close",
                notes: "Notes",
                showKhrPrices: "Show KHR",
                showUsdPrices: "Show USD",
                discount: "Discount",
                applyDiscount: "Apply Discount",
                removeDiscount: "Remove Discount",
                discountAmount: "Discount Amount",
                discountType: "Discount Type",
                percentage: "Percentage",
                fixedAmount: "Fixed Amount",
                discountApplied: "Discount Applied",
                enterDiscount: "Enter discount amount",
                searchProducts: "Search products...",
                searchResults: "Search results",
                showingResultsFor: "Showing results for",
                noResultsFound: "No products found",
                clearSearch: "Clear search",
                printerSettings: "Printer Settings",
                printerIpAddress: "Printer IP Address",
                printerPort: "Printer Port",
                testPrinter: "Test Printer",
                savePrinterSettings: "Save Printer Settings",
                printerConfiguration: "Printer Configuration",
                printerHelp: "Printer Setup Help",
                printerHelpSteps: "To connect your Star TSP100III printer:",
                printerStep1: "Connect your printer to the same Wi-Fi network as your iPad",
                printerStep2: "Find your printer's IP address (print a test page from the printer)",
                printerStep3: "Enter the IP address above (usually like 192.168.1.100)",
                printerStep4: "Click 'Test Printer' to verify the connection",
                printerStep5: "Save the settings and start printing!",
                printerTestSuccess: "Printer connection successful!",
                printerTestError: "Failed to connect to printer. Please check the IP address and network connection.",
                printerSettingsSaved: "Printer settings saved successfully!",
                configurePrinter: "Configure Printer",
                clearHistory: "Clear History",
                clearHistoryConfirm: "Are you sure you want to clear all order history? This cannot be undone.",
                historyCleared: "Order history cleared successfully!",
                exportToExcel: "Export to Excel",
                exportDetailedExcel: "Export Detailed Excel",
                excelExportSuccess: "Excel report exported successfully!",
                excelExportError: "Error exporting to Excel. Please try again.",
                noOrdersToExport: "No orders to export for the selected period.",
                addProduct: "Add Product",
                productName: "Product Name",
                productNameKh: "Product Name (Khmer)",
                productPrice: "Price ($)",
                productCategory: "Category",
                productImage: "Image URL",
                addNewProduct: "Add New Product",
                saveProduct: "Save Product",
                editProduct: "Edit Product",
                deleteProduct: "Delete Product",
                productAdded: "Product added successfully!",
                productUpdated: "Product updated successfully!",
                productDeleted: "Product deleted successfully!",
                manageProducts: "Manage Products",
                currentProducts: "Current Products",
                noProducts: "No products found",
                fillAllFields: "Please fill in all required fields",
                enterValidPrice: "Please enter a valid price",
                confirmDelete: "Are you sure you want to delete this product?",
                // New printing translations
                printReceipt: "Print Receipt",
                printingViaUSB: "Printing via USB...",
                printingViaNetwork: "Printing via network...",
                printingViaBrowser: "Printing via browser...",
                usbPrintSuccess: "Receipt printed via USB!",
                networkPrintSuccess: "Receipt sent to network printer!",
                browserPrintSuccess: "Receipt ready for printing!",
                printError: "Print error: ",
                noPrinterSelected: "No printer selected",
                grantUsbPermission: "Grant USB Permission",
                usbPrinterSetup: "USB Printer Setup",
                usbSetupInstructions: "Connect your Star TSP100III printer via USB cable and click below to grant permission.",
                platformInfoIpad: "iPad detected: Use Network Printer in settings for best results",
                platformInfoAndroid: "Android device: USB printing available. Connect your printer via USB cable."
            },
            km: {
                pointOfSale: "",
                reports: "",
                hotSales: "",
                coffee: "",
                frappe: "",
                milkTea: "",
                other: "",
                soda: "",
                sugarLevel: "",
                topping: "",
                snowPearls: "",
                honeyJack: "",
                cream: "",
                enterSale: "",
                order: "",
                items: "",
                noItems: "",
                subtotal: "",
                total: "",
                pay: "",
                addNotes: "...",
                specialInstructions: " ",
                customize: "",
                noSugar: "",
                light: "",
                mediumLight: "",
                medium: "",
                standard: "",
                extra: "",
                cancel: "",
                confirm: "",
                reportType: "",
                dailyReport: "",
                monthlyReport: "",
                selectDate: "",
                selectMonth: "",
                totalSales: "",
                totalOrders: "",
                averageOrder: "",
                productsSold: "",
                dailySalesReport: "",
                monthlySalesReport: "",
                salesByCategory: "",
                orderDetails: "",
                orderId: "",
                dateTime: " & ",
                status: "",
                noOrders: "",
                royalTeaCafe: "Royal Tea&Cafe",
                orderReceipt: "",
                thankYou: " !",
                comeAgain: "",
                print: "",
                close: "",
                notes: "",
                showKhrPrices: "",
                showUsdPrices: "",
                discount: "",
                applyDiscount: "",
                removeDiscount: "",
                discountAmount: "",
                discountType: "",
                percentage: "",
                fixedAmount: "",
                discountApplied: "",
                enterDiscount: "",
                searchProducts: "...",
                searchResults: "",
                showingResultsFor: "",
                noResultsFound: "",
                clearSearch: "",
                printerSettings: "",
                printerIpAddress: " IP ",
                printerPort: "",
                testPrinter: "",
                savePrinterSettings: "",
                printerConfiguration: "",
                printerHelp: "",
                printerHelpSteps: " Star TSP100III ",
                printerStep1: " Wi-Fi  iPad ",
                printerStep2: " IP  ()",
                printerStep3: " IP  ( 192.168.1.100)",
                printerStep4: " '' ",
                printerStep5: " !",
                printerTestSuccess: "!",
                printerTestError: "  IP ",
                printerSettingsSaved: "!",
                configurePrinter: "",
                clearHistory: "",
                clearHistoryConfirm: "? ",
                historyCleared: "!",
                exportToExcel: " Excel",
                exportDetailedExcel: " Excel ",
                excelExportSuccess: " Excel !",
                excelExportError: " Excel ",
                noOrdersToExport: "",
                addProduct: "",
                productName: "",
                productNameKh: " ()",
                productPrice: " ($)",
                productCategory: "",
                productImage: "URL ",
                addNewProduct: "",
                saveProduct: "",
                editProduct: "",
                deleteProduct: "",
                productAdded: "!",
                productUpdated: "!",
                productDeleted: "!",
                manageProducts: "",
                currentProducts: "",
                noProducts: "",
                fillAllFields: "",
                enterValidPrice: "",
                confirmDelete: "?",
                // New printing translations
                printReceipt: "",
                printingViaUSB: " USB...",
                printingViaNetwork: "...",
                printingViaBrowser: "...",
                usbPrintSuccess: " USB!",
                networkPrintSuccess: "!",
                browserPrintSuccess: "!",
                printError: " ",
                noPrinterSelected: "",
                grantUsbPermission: " USB",
                usbPrinterSetup: " USB",
                usbSetupInstructions: " Star TSP100III  cable USB ",
                platformInfoIpad: "iPad  ",
                platformInfoAndroid: " Android  USB   cable USB"
            }
        };

        // ImageSlider Component
        const ImageSlider = () => {
            const [currentSlide, setCurrentSlide] = useState(0);
            
            useEffect(() => {
                const interval = setInterval(() => {
                    setCurrentSlide(prev => (prev + 1) % 3);
                }, 4000);
                
                return () => clearInterval(interval);
            }, []);
            
            const goToSlide = (index) => {
                setCurrentSlide(index);
            };
            
            return (
                <div className="slider-container">
                    <div className="slider" style={{ transform: `translateX(-${currentSlide * 33.33}%)` }}>
                        <div className="slide slide-1">
                            <div></div>
                        </div>
                        <div className="slide slide-2">
                            <div></div>
                        </div>
                        <div className="slide slide-3">
                            <div></div>
                        </div>
                    </div>
                    <div className="slider-nav">
                        {[0, 1, 2].map(index => (
                            <div 
                                key={index}
                                className={`slider-dot ${currentSlide === index ? 'active' : ''}`}
                                onClick={() => goToSlide(index)}
                            />
                        ))}
                    </div>
                </div>
            );
        };

        // CustomizationModal Component
        const CustomizationModal = ({ item, onConfirm, onCancel, language, showKhrPrices }) => {
            const [selectedSugar, setSelectedSugar] = useState('100%');
            const [selectedTopping, setSelectedTopping] = useState(null);
            
            const sugarOptions = [
                { percentage: '0%', label: language === 'en' ? 'No Sugar' : '' },
                { percentage: '25%', label: language === 'en' ? 'Light' : '' },
                { percentage: '50%', label: language === 'en' ? 'Medium Light' : '' },
                { percentage: '75%', label: language === 'en' ? 'Medium' : '' },
                { percentage: '100%', label: language === 'en' ? 'Standard' : '' },
                { percentage: '125%', label: language === 'en' ? 'Extra' : '' }
            ];
            
            return (
                <div className="customization-modal-overlay">
                    <div className="customization-modal">
                        <div className="customization-modal-header">
                            <h3>{language === 'en' ? 'Customize' : ''} {item.name}</h3>
                        </div>
                        
                        <div className="customization-section">
                            <div className="customization-title">{language === 'en' ? 'Sugar Level' : ''}</div>
                            <div className="sugar-options">
                                {sugarOptions.map(option => (
                                    <div 
                                        key={option.percentage}
                                        className={`sugar-option ${selectedSugar === option.percentage ? 'selected' : ''}`}
                                        onClick={() => setSelectedSugar(option.percentage)}
                                    >
                                        <div className="sugar-percentage">{option.percentage}</div>
                                        <div className="sugar-label">{option.label}</div>
                                    </div>
                                ))}
                            </div>
                        </div>
                        
                        <div className="customization-section">
                            <div className="customization-title">
                                {language === 'en' ? 'Toppings (+$0.50 each)' : ' (+.$ )'}
                                {showKhrPrices && (
                                    <span className="khmer-price"> ({formatKhrPrice(usdToKhr(0.50))})</span>
                                )}
                            </div>
                            <div className="topping-options">
                                {toppingOptions.map(topping => (
                                    <div 
                                        key={topping.id}
                                        className={`topping-option ${selectedTopping?.id === topping.id ? 'selected' : ''}`}
                                        onClick={() => setSelectedTopping(topping)}
                                    >
                                        <div className="topping-name">{language === 'en' ? topping.name : topping.nameKh}</div>
                                        <div className="topping-price">
                                            <span className="usd-price">${topping.price.toFixed(2)}</span>
                                            {showKhrPrices && (
                                                <div className="khmer-price">{formatKhrPrice(usdToKhr(topping.price))}</div>
                                            )}
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>
                        
                        <div className="modal-buttons">
                            <button className="modal-btn cancel-btn" onClick={onCancel}>
                                {language === 'en' ? 'Cancel' : ''}
                            </button>
                            <button className="modal-btn confirm-btn" onClick={() => onConfirm(selectedSugar, selectedTopping)}>
                                {language === 'en' ? 'Confirm' : ''}
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        // ReceiptModal Component
        const ReceiptModal = ({ cart, notes, orderNumber, onClose, onPrint, language, showKhrPrices, discount }) => {
            const t = translations[language];
            
            const getSubtotal = () => {
                return cart.reduce((total, item) => {
                    let itemTotal = item.price * item.quantity;
                    if (item.topping) {
                        itemTotal += item.topping.price * item.quantity;
                    }
                    return total + itemTotal;
                }, 0);
            };

            const getDiscountAmount = () => {
                if (!discount || !discount.amount) return 0;
                
                if (discount.type === 'percentage') {
                    return getSubtotal() * (discount.amount / 100);
                } else {
                    return discount.amount;
                }
            };

            const getTotal = () => {
                const subtotal = getSubtotal();
                const discountAmount = getDiscountAmount();
                return Math.max(0, subtotal - discountAmount);
            };

            return (
                <div className="modal-overlay">
                    <div className="receipt-modal">
                        <div className="receipt-header">
                            <h2>{t.royalTeaCafe}</h2>
                            <p>{t.orderReceipt}</p>
                        </div>
                        <div className="receipt-body">
                            <div className="receipt-info">
                                <p>{t.orderId}: {orderNumber}</p>
                                <p>{language === 'en' ? 'Date' : ''}: {new Date().toLocaleDateString()}</p>
                                <p>{language === 'en' ? 'Time' : ''}: {new Date().toLocaleTimeString()}</p>
                            </div>
                            
                            <div className="receipt-items">
                                {cart.map(item => {
                                    const itemTotal = (item.price + (item.topping ? item.topping.price : 0)) * item.quantity;
                                    return (
                                        <div key={`${item.id}-${item.sugarLevel}-${item.topping?.id}`} className="receipt-item">
                                            <div className="receipt-item-details">
                                                <div>
                                                    <strong>{item.quantity}x</strong> {language === 'en' ? item.name : item.nameKh}
                                                </div>
                                                {item.sugarLevel && (
                                                    <div className="receipt-sugar">{t.sugarLevel}: {item.sugarLevel}</div>
                                                )}
                                                {item.topping && (
                                                    <div className="receipt-topping">{t.topping}: {language === 'en' ? item.topping.name : item.topping.nameKh} (+${item.topping.price.toFixed(2)})</div>
                                                )}
                                            </div>
                                            <div className="receipt-item-price">
                                                <span className="usd-price">${itemTotal.toFixed(2)}</span>
                                                {showKhrPrices && (
                                                    <div className="khmer-price-receipt">{formatKhrPrice(usdToKhr(itemTotal))}</div>
                                                )}
                                            </div>
                                        </div>
                                    );
                                })}
                            </div>
                            
                            <div className="receipt-totals">
                                <div className="receipt-total-row">
                                    <div>{t.subtotal}:</div>
                                    <div className="receipt-item-price">
                                        <span className="usd-price">${getSubtotal().toFixed(2)}</span>
                                        {showKhrPrices && (
                                            <div className="khmer-price-receipt">{formatKhrPrice(usdToKhr(getSubtotal()))}</div>
                                        )}
                                    </div>
                                </div>
                                
                                {discount && discount.amount > 0 && (
                                    <div className="receipt-total-row discount-row">
                                        <div>{t.discount}: 
                                            {discount.type === 'percentage' ? ` (${discount.amount}%)` : ''}
                                        </div>
                                        <div className="receipt-item-price">
                                            <span className="usd-price">-${getDiscountAmount().toFixed(2)}</span>
                                            {showKhrPrices && (
                                                <div className="khmer-price-receipt">-{formatKhrPrice(usdToKhr(getDiscountAmount()))}</div>
                                            )}
                                        </div>
                                    </div>
                                )}
                                
                                <div className="receipt-total-row total-final">
                                    <div>{t.total}:</div>
                                    <div className="receipt-item-price">
                                        <span className="usd-price">${getTotal().toFixed(2)}</span>
                                        {showKhrPrices && (
                                            <div className="khmer-price-receipt khmer-total">{formatKhrPrice(usdToKhr(getTotal()))}</div>
                                        )}
                                    </div>
                                </div>
                            </div>
                            
                            {notes && (
                                <div className="receipt-notes">
                                    <p><strong>{t.notes}:</strong> {notes}</p>
                                </div>
                            )}
                        </div>
                        
                        <div className="receipt-footer">
                            <p>{t.thankYou}</p>
                            <p>{t.comeAgain}</p>
                        </div>
                        
                        <div className="receipt-buttons">
                            <button className="print-btn" onClick={onPrint}>
                                <i className="fas fa-print"></i> {t.print}
                            </button>
                            <button className="close-btn" onClick={onClose}>
                                <i className="fas fa-times"></i> {t.close}
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        // PrinterConfigModal Component
        const PrinterConfigModal = ({ onClose, onSave, language, currentSettings }) => {
            const [ipAddress, setIpAddress] = useState(currentSettings?.ipAddress || '');
            const [port, setPort] = useState(currentSettings?.port || '80');
            const [testStatus, setTestStatus] = useState(null);
            
            const t = translations[language];
            
            const handleTest = async () => {
                if (!ipAddress) {
                    setTestStatus({ success: false, message: 'Please enter IP address' });
                    return;
                }
                
                setTestStatus({ success: null, message: 'Testing connection...' });
                
                // Simulate printer test
                setTimeout(() => {
                    if (ipAddress.includes('192.168') || ipAddress.includes('10.0') || ipAddress.includes('172.')) {
                        setTestStatus({ success: true, message: t.printerTestSuccess });
                    } else {
                        setTestStatus({ success: false, message: t.printerTestError });
                    }
                }, 1500);
            };
            
            const handleSave = () => {
                onSave({ ipAddress, port });
            };
            
            return (
                <div className="modal-overlay">
                    <div className="printer-config-modal">
                        <div className="customization-modal-header">
                            <h3>{t.printerConfiguration}</h3>
                        </div>
                        
                        <div className="printer-config-section">
                            <div className="printer-config-title">{t.printerIpAddress}</div>
                            <input
                                type="text"
                                className="printer-input"
                                placeholder="192.168.1.100"
                                value={ipAddress}
                                onChange={(e) => setIpAddress(e.target.value)}
                            />
                            
                            <div className="printer-config-title">{t.printerPort}</div>
                            <input
                                type="text"
                                className="printer-input"
                                placeholder="80"
                                value={port}
                                onChange={(e) => setPort(e.target.value)}
                            />
                            
                            <button className="printer-test-btn" onClick={handleTest}>
                                {t.testPrinter}
                            </button>
                            
                            {testStatus && (
                                <div className={`printer-status ${testStatus.success ? 'success' : 'error'}`}>
                                    {testStatus.message}
                                </div>
                            )}
                        </div>
                        
                        <div className="printer-help">
                            <h4>{t.printerHelp}</h4>
                            <ol>
                                <li>{t.printerStep1}</li>
                                <li>{t.printerStep2}</li>
                                <li>{t.printerStep3}</li>
                                <li>{t.printerStep4}</li>
                                <li>{t.printerStep5}</li>
                            </ol>
                        </div>
                        
                        <div className="modal-buttons">
                            <button className="modal-btn cancel-btn" onClick={onClose}>
                                {language === 'en' ? 'Cancel' : ''}
                            </button>
                            <button className="modal-btn confirm-btn" onClick={handleSave}>
                                {t.savePrinterSettings}
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        // ProductManagerModal Component
        const ProductManagerModal = ({ onClose, language, onProductsUpdate, user }) => {
            const [newProduct, setNewProduct] = useState({
                name: '',
                nameKh: '',
                price: '',
                category: 'HOT SALES',
                image: ''
            });
            const [editingProduct, setEditingProduct] = useState(null);
            
            const t = translations[language];
            const categories = ['HOT SALES', 'COFFEE', 'FRAPPE', 'MILK TEA', 'OTHER', 'SODA'];

            const handleAddProduct = () => {
                if (!newProduct.name || !newProduct.nameKh || !newProduct.price || !newProduct.category) {
                    alert(t.fillAllFields);
                    return;
                }

                const price = parseFloat(newProduct.price);
                if (isNaN(price) || price <= 0) {
                    alert(t.enterValidPrice);
                    return;
                }

                // Generate a new ID (find the highest current ID and add 1)
                const allProducts = Object.values(menuData).flat();
                const maxId = Math.max(...allProducts.map(p => p.id), 0);
                const newId = maxId + 1;

                const productToAdd = {
                    id: newId,
                    name: newProduct.name,
                    nameKh: newProduct.nameKh,
                    price: price,
                    category: newProduct.category,
                    image: newProduct.image || 'https://food-cms.grab.com/compressed_webp/items/KHITEA20250329185400870518/detail/3766b6f6eaba4891bebd9fde7141dac0_1743326057978577924.webp'
                };

                // Add to menuData
                if (!menuData[newProduct.category]) {
                    menuData[newProduct.category] = [];
                }
                menuData[newProduct.category].push(productToAdd);

                // Save to localStorage
                saveMenuDataToStorage(menuData);

                // Notify parent component
                onProductsUpdate();

                // Reset form
                setNewProduct({
                    name: '',
                    nameKh: '',
                    price: '',
                    category: 'HOT SALES',
                    image: ''
                });

                alert(t.productAdded);
            };

            const handleEditProduct = (product) => {
                setEditingProduct(product);
                setNewProduct({
                    name: product.name,
                    nameKh: product.nameKh,
                    price: product.price.toString(),
                    category: product.category,
                    image: product.image
                });
            };

            const handleUpdateProduct = () => {
                if (!newProduct.name || !newProduct.nameKh || !newProduct.price || !newProduct.category) {
                    alert(t.fillAllFields);
                    return;
                }

                const price = parseFloat(newProduct.price);
                if (isNaN(price) || price <= 0) {
                    alert(t.enterValidPrice);
                    return;
                }

                // Find and update the product
                let productFound = false;
                Object.keys(menuData).forEach(category => {
                    menuData[category] = menuData[category].map(product => {
                        if (product.id === editingProduct.id) {
                            productFound = true;
                            return {
                                ...product,
                                name: newProduct.name,
                                nameKh: newProduct.nameKh,
                                price: price,
                                category: newProduct.category,
                                image: newProduct.image || product.image
                            };
                        }
                        return product;
                    });
                });

                if (productFound) {
                    // Save to localStorage
                    saveMenuDataToStorage(menuData);

                    // Notify parent component
                    onProductsUpdate();

                    // Reset form
                    setNewProduct({
                        name: '',
                        nameKh: '',
                        price: '',
                        category: 'HOT SALES',
                        image: ''
                    });
                    setEditingProduct(null);

                    alert(t.productUpdated);
                }
            };

            const handleDeleteProduct = (product) => {
                if (window.confirm(t.confirmDelete)) {
                    // Remove product from menuData
                    Object.keys(menuData).forEach(category => {
                        menuData[category] = menuData[category].filter(p => p.id !== product.id);
                    });

                    // Save to localStorage
                    saveMenuDataToStorage(menuData);

                    // Notify parent component
                    onProductsUpdate();

                    alert(t.productDeleted);
                }
            };

            const cancelEdit = () => {
                setEditingProduct(null);
                setNewProduct({
                    name: '',
                    nameKh: '',
                    price: '',
                    category: 'HOT SALES',
                    image: ''
                });
            };

            const getAllProducts = () => {
                return Object.values(menuData).flat();
            };

            const getCategoryName = (category, language) => {
                const categoryMap = {
                    'HOT SALES': language === 'en' ? 'HOT SALES' : '',
                    'COFFEE': language === 'en' ? 'COFFEE' : '',
                    'FRAPPE': language === 'en' ? 'FRAPPE' : '',
                    'MILK TEA': language === 'en' ? 'MILK TEA' : '',
                    'OTHER': language === 'en' ? 'OTHER' : '',
                    'SODA': language === 'en' ? 'SODA' : ''
                };
                return categoryMap[category] || category;
            };

            return (
                <div className="modal-overlay">
                    <div className="product-manager-modal">
                        <div className="customization-modal-header">
                            <h3>{t.manageProducts}</h3>
                        </div>
                        
                        <div className="product-form">
                            <h4>{editingProduct ? t.editProduct : t.addNewProduct}</h4>
                            
                            <div className="form-group">
                                <label>{t.productName} *</label>
                                <input
                                    type="text"
                                    value={newProduct.name}
                                    onChange={(e) => setNewProduct({...newProduct, name: e.target.value})}
                                    placeholder={language === 'en' ? 'Enter product name' : ''}
                                />
                            </div>
                            
                            <div className="form-group">
                                <label>{t.productNameKh} *</label>
                                <input
                                    type="text"
                                    value={newProduct.nameKh}
                                    onChange={(e) => setNewProduct({...newProduct, nameKh: e.target.value})}
                                    placeholder={language === 'en' ? 'Enter product name in Khmer' : ''}
                                />
                            </div>
                            
                            <div className="form-group">
                                <label>{t.productPrice} *</label>
                                <input
                                    type="number"
                                    step="0.01"
                                    min="0"
                                    value={newProduct.price}
                                    onChange={(e) => setNewProduct({...newProduct, price: e.target.value})}
                                    placeholder={language === 'en' ? 'Enter price in USD' : ''}
                                />
                            </div>
                            
                            <div className="form-group">
                                <label>{t.productCategory} *</label>
                                <select
                                    value={newProduct.category}
                                    onChange={(e) => setNewProduct({...newProduct, category: e.target.value})}
                                >
                                    {categories.map(category => (
                                        <option key={category} value={category}>
                                            {getCategoryName(category, language)}
                                        </option>
                                    ))}
                                </select>
                            </div>
                            
                            <div className="form-group">
                                <label>{t.productImage}</label>
                                <input
                                    type="text"
                                    value={newProduct.image}
                                    onChange={(e) => setNewProduct({...newProduct, image: e.target.value})}
                                    placeholder={language === 'en' ? 'Enter image URL (optional)' : ' URL  ()'}
                                />
                            </div>
                            
                            <div className="form-actions">
                                {editingProduct ? (
                                    <>
                                        <button className="cancel-btn" onClick={cancelEdit}>
                                            {t.cancel}
                                        </button>
                                        <button className="save-btn" onClick={handleUpdateProduct}>
                                            {t.saveProduct}
                                        </button>
                                    </>
                                ) : (
                                    <button className="save-btn" onClick={handleAddProduct}>
                                        {t.addProduct}
                                    </button>
                                )}
                            </div>
                        </div>
                        
                        <div className="product-list">
                            <h4>{t.currentProducts}</h4>
                            {getAllProducts().length === 0 ? (
                                <p>{t.noProducts}</p>
                            ) : (
                                getAllProducts().map(product => (
                                    <div key={product.id} className="product-item">
                                        <div className="product-info">
                                            <h4>{language === 'en' ? product.name : product.nameKh}</h4>
                                            <p>{getCategoryName(product.category, language)} - ${product.price.toFixed(2)}</p>
                                        </div>
                                        <div className="product-actions">
                                            <button 
                                                className="edit-btn"
                                                onClick={() => handleEditProduct(product)}
                                            >
                                                <i className="fas fa-edit"></i>
                                            </button>
                                            <button 
                                                className="delete-btn"
                                                onClick={() => handleDeleteProduct(product)}
                                            >
                                                <i className="fas fa-trash"></i>
                                            </button>
                                        </div>
                                    </div>
                                ))
                            )}
                        </div>
                        
                        <div className="modal-buttons">
                            <button className="modal-btn cancel-btn" onClick={onClose}>
                                {t.close}
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        // Helper function to get category name in current language
        const getCategoryName = (category, language) => {
            const categoryMap = {
                'HOT SALES': language === 'en' ? 'HOT SALES' : '',
                'COFFEE': language === 'en' ? 'COFFEE' : '',
                'FRAPPE': language === 'en' ? 'FRAPPE' : '',
                'MILK TEA': language === 'en' ? 'MILK TEA' : '',
                'OTHER': language === 'en' ? 'OTHER' : '',
                'SODA': language === 'en' ? 'SODA' : ''
            };
            return categoryMap[category] || category;
        };

        // Main CafeDashboard Component
        const CafeDashboard = ({ user }) => {
            const [activeTab, setActiveTab] = useState('pos');
            const [activeCategory, setActiveCategory] = useState('HOT SALES');
            const [cart, setCart] = useState([]);
            const [notes, setNotes] = useState('');
            const [orderNumber, setOrderNumber] = useState(1);
            const [reportType, setReportType] = useState('daily');
            const [selectedDate, setSelectedDate] = useState(new Date().toISOString().split('T')[0]);
            const [selectedMonth, setSelectedMonth] = useState(new Date().toISOString().substring(0, 7));
            const [showProductManager, setShowProductManager] = useState(false);
            
            // Load orders from localStorage on component mount
            const [orders, setOrders] = useState(() => {
                return loadOrdersFromStorage();
            });
            
            const [showReceipt, setShowReceipt] = useState(false);
            const [showCustomizationModal, setShowCustomizationModal] = useState(false);
            const [selectedItem, setSelectedItem] = useState(null);
            const [lastOrder, setLastOrder] = useState(null);
            const [language, setLanguage] = useState('en');
            const [showKhrPrices, setShowKhrPrices] = useState(false);
            const [lastResetDate, setLastResetDate] = useState(localStorage.getItem('lastResetDate') || new Date().toLocaleDateString());
            const [searchQuery, setSearchQuery] = useState('');
            const [searchResults, setSearchResults] = useState([]);
            const [isSearching, setIsSearching] = useState(false);
            const [discount, setDiscount] = useState(null);
            const [discountAmount, setDiscountAmount] = useState('');
            const [discountType, setDiscountType] = useState('percentage');
            const [printerSettings, setPrinterSettings] = useState(() => {
                const saved = localStorage.getItem('printerSettings');
                return saved ? JSON.parse(saved) : { ipAddress: '', port: '80' };
            });
            const [showPrinterConfig, setShowPrinterConfig] = useState(false);
            const [printStatus, setPrintStatus] = useState(null);
            const [showPrintStatus, setShowPrintStatus] = useState(false);
            const [platformInfoHidden, setPlatformInfoHidden] = useState(false);
            
            // Detect platform
            const platform = detectPlatform();
            
            const dailySalesChartRef = useRef(null);
            const categorySalesChartRef = useRef(null);
            
            const t = translations[language];
            
            // Save orders to localStorage whenever orders change
            useEffect(() => {
                try {
                    localStorage.setItem('royalCafeOrders', JSON.stringify(orders));
                } catch (error) {
                    console.error('Error saving orders to storage:', error);
                }
            }, [orders]);
            
            // Show platform info banner on first load
            useEffect(() => {
                if (platform.isMobile && !localStorage.getItem('platformInfoHidden')) {
                    setPlatformInfoHidden(false);
                }
            }, [platform.isMobile]);
            
            // Hide platform info banner
            const hidePlatformInfo = () => {
                setPlatformInfoHidden(true);
                localStorage.setItem('platformInfoHidden', 'true');
            };
            
            // Test USB permission (Android only)
            const testUsbPermission = async () => {
                if (!platform.supportsWebUSB || platform.isIOS) {
                    setPrintStatus({ 
                        success: false, 
                        message: language === 'en' 
                            ? 'USB printing not supported on this device' 
                            : ' USB ' 
                    });
                    setShowPrintStatus(true);
                    return;
                }
                
                try {
                    // Just request permission without printing
                    await navigator.usb.requestDevice({ 
                        filters: [{ vendorId: 0x0519 }] 
                    });
                    
                    setPrintStatus({ 
                        success: true, 
                        message: language === 'en' 
                            ? 'USB permission granted! Now connect your printer and try printing a receipt.' 
                            : ' USB !  ' 
                    });
                    setShowPrintStatus(true);
                } catch (error) {
                    setPrintStatus({ 
                        success: false, 
                        message: language === 'en' 
                            ? 'USB permission cancelled or no printer found' 
                            : ' USB  ' 
                    });
                    setShowPrintStatus(true);
                }
            };
            
            // UPDATED PRINT FUNCTION - Now supports USB, Network, and Browser printing
            const printReceipt = async () => {
                if (!lastOrder) return;
                
                const receiptData = {
                    orderNumber: lastOrder.id,
                    items: lastOrder.items,
                    subtotal: lastOrder.subtotal,
                    discount: getDiscountAmount(),
                    total: lastOrder.total,
                    date: new Date().toLocaleDateString(),
                    time: new Date().toLocaleTimeString(),
                    cashier: user.displayName,
                    notes: notes
                };
                
                // Show printing status
                setPrintStatus({ success: null, message: t.printingViaBrowser });
                setShowPrintStatus(true);
                
                let result;
                
                // Try WebUSB first (Android Chrome)
                if (platform.supportsWebUSB) {
                    setPrintStatus({ success: null, message: t.printingViaUSB });
                    result = await printViaWebUSB(receiptData, language);
                    
                    if (result.success) {
                        setPrintStatus({ success: true, message: t.usbPrintSuccess });
                        setTimeout(() => setShowPrintStatus(false), 2000);
                        return;
                    }
                }
                
                // Try network printing
                if (printerSettings.ipAddress) {
                    setPrintStatus({ success: null, message: t.printingViaNetwork });
                    result = await printViaNetwork(receiptData, language, printerSettings);
                    
                    if (result.success) {
                        setPrintStatus({ success: true, message: t.networkPrintSuccess });
                        setTimeout(() => setShowPrintStatus(false), 2000);
                        return;
                    }
                }
                
                // Fallback to browser print
                setPrintStatus({ success: null, message: t.printingViaBrowser });
                
                setTimeout(() => {
                    window.print();
                    setPrintStatus({ success: true, message: t.browserPrintSuccess });
                    setTimeout(() => setShowPrintStatus(false), 2000);
                }, 1000);
            };
            
            // Retry printing
            const retryPrint = async () => {
                setShowPrintStatus(false);
                setTimeout(() => printReceipt(), 500);
            };
            
            // Fallback to browser print
            const fallbackToBrowserPrint = () => {
                setShowPrintStatus(false);
                setTimeout(() => {
                    window.print();
                }, 500);
            };
            
            // Close print status
            const closePrintStatus = () => {
                setShowPrintStatus(false);
            };
            
            // Rest of your existing functions
            const handleSearch = (query) => {
                setSearchQuery(query);
            };
            
            const clearSearch = () => {
                setSearchQuery('');
                setSearchResults([]);
                setIsSearching(false);
            };
            
            const getProductsToDisplay = () => {
                if (isSearching && searchQuery.trim() !== '') {
                    return searchResults;
                }
                return menuData[activeCategory] || [];
            };
            
            const applyDiscount = () => {
                if (!discountAmount || isNaN(discountAmount) || parseFloat(discountAmount) <= 0) {
                    alert(language === 'en' ? 'Please enter a valid discount amount' : '');
                    return;
                }
                
                const amount = parseFloat(discountAmount);
                
                if (discountType === 'percentage' && (amount < 0 || amount > 100)) {
                    alert(language === 'en' ? 'Percentage discount must be between 0% and 100%' : ' 0%  100%');
                    return;
                }
                
                setDiscount({
                    amount: amount,
                    type: discountType
                });
                
                setDiscountAmount('');
            };

            const removeDiscount = () => {
                setDiscount(null);
                setDiscountAmount('');
            };

            const getSubtotal = () => {
                return cart.reduce((total, item) => {
                    let itemTotal = item.price * item.quantity;
                    if (item.topping) {
                        itemTotal += item.topping.price * item.quantity;
                    }
                    return total + itemTotal;
                }, 0);
            };

            const getDiscountAmount = () => {
                if (!discount || !discount.amount) return 0;
                
                if (discount.type === 'percentage') {
                    return getSubtotal() * (discount.amount / 100);
                } else {
                    return discount.amount;
                }
            };

            const getTotal = () => {
                const subtotal = getSubtotal();
                const discountAmount = getDiscountAmount();
                return Math.max(0, subtotal - discountAmount);
            };

            const exportToExcel = () => {
                const filteredOrders = orders.filter(order => {
                    const orderDate = new Date(order.date);
                    
                    if (reportType === 'daily') {
                        return orderDate.toISOString().split('T')[0] === selectedDate;
                    } else {
                        return orderDate.toISOString().substring(0, 7) === selectedMonth;
                    }
                });
                
                if (filteredOrders.length === 0) {
                    alert(language === 'en' 
                        ? "No orders to export for the selected period." 
                        : "");
                    return;
                }

                try {
                    // Prepare data for Excel
                    const excelData = [];
                    
                    // Add header row
                    const headers = [
                        t.orderId,
                        t.dateTime,
                        language === 'en' ? 'Items Count' : '',
                        t.subtotal,
                        t.discount,
                        t.total,
                        t.status
                    ];
                    excelData.push(headers);
                    
                    // Add data rows
                    filteredOrders.forEach(order => {
                        const itemsCount = order.items.reduce((sum, item) => sum + item.quantity, 0);
                        const discountAmount = order.discount ? 
                            (order.discount.type === 'percentage' 
                                ? `${order.discount.amount}%` 
                                : `$${order.discount.amount.toFixed(2)}`)
                            : '$0.00';
                        
                        const row = [
                            order.id,
                            new Date(order.date).toLocaleString(),
                            itemsCount,
                            `$${order.subtotal.toFixed(2)}`,
                            discountAmount,
                            `$${order.total.toFixed(2)}`,
                            order.status
                        ];
                        excelData.push(row);
                    });
                    
                    // Create worksheet
                    const ws = XLSX.utils.aoa_to_sheet(excelData);
                    
                    // Create workbook
                    const wb = XLSX.utils.book_new();
                    XLSX.utils.book_append_sheet(wb, ws, 'Sales Report');
                    
                    // Generate filename with date
                    const reportDate = reportType === 'daily' 
                        ? selectedDate 
                        : selectedMonth;
                    const filename = `Royal_Cafe_Sales_Report_${reportDate}.xlsx`;
                    
                    // Export to Excel
                    XLSX.writeFile(wb, filename);
                    
                    // Show success message
                    setPrintStatus({ 
                        success: true, 
                        message: language === 'en' 
                            ? 'Excel report exported successfully!' 
                            : ' Excel !'
                    });
                    
                    setTimeout(() => setPrintStatus(null), 3000);
                    
                } catch (error) {
                    console.error('Error exporting to Excel:', error);
                    setPrintStatus({ 
                        success: false, 
                        message: language === 'en' 
                            ? 'Error exporting to Excel. Please try again.' 
                            : ' Excel '
                    });
                    
                    setTimeout(() => setPrintStatus(null), 3000);
                }
            };

            const exportDetailedExcel = () => {
                const filteredOrders = orders.filter(order => {
                    const orderDate = new Date(order.date);
                    
                    if (reportType === 'daily') {
                        return orderDate.toISOString().split('T')[0] === selectedDate;
                    } else {
                        return orderDate.toISOString().substring(0, 7) === selectedMonth;
                    }
                });
                
                if (filteredOrders.length === 0) {
                    alert(language === 'en' 
                        ? "No orders to export for the selected period." 
                        : "");
                    return;
                }

                try {
                    // Prepare detailed data for Excel
                    const detailedData = [];
                    
                    // Add header row for detailed report
                    const detailedHeaders = [
                        t.orderId,
                        t.dateTime,
                        language === 'en' ? 'Item Name' : '',
                        language === 'en' ? 'Item Name (KH)' : ' (EN)',
                        language === 'en' ? 'Quantity' : '',
                        language === 'en' ? 'Sugar Level' : '',
                        language === 'en' ? 'Topping' : '',
                        language === 'en' ? 'Unit Price' : '',
                        language === 'en' ? 'Item Total' : '',
                        t.status
                    ];
                    detailedData.push(detailedHeaders);
                    
                    // Add detailed data rows
                    filteredOrders.forEach(order => {
                        order.items.forEach(item => {
                            const itemTotal = (item.price + (item.topping ? item.topping.price : 0)) * item.quantity;
                            const toppingName = item.topping 
                                ? (language === 'en' ? item.topping.name : item.topping.nameKh)
                                : '';
                            
                            const row = [
                                order.id,
                                new Date(order.date).toLocaleString(),
                                item.name,
                                item.nameKh,
                                item.quantity,
                                item.sugarLevel || '',
                                toppingName,
                                `$${(item.price + (item.topping ? item.topping.price : 0)).toFixed(2)}`,
                                `$${itemTotal.toFixed(2)}`,
                                order.status
                            ];
                            detailedData.push(row);
                        });
                    });
                    
                    // Create worksheet
                    const ws = XLSX.utils.aoa_to_sheet(detailedData);
                    
                    // Create workbook
                    const wb = XLSX.utils.book_new();
                    XLSX.utils.book_append_sheet(wb, ws, 'Detailed Sales Report');
                    
                    // Generate filename with date
                    const reportDate = reportType === 'daily' 
                        ? selectedDate 
                        : selectedMonth;
                    const filename = `Royal_Cafe_Detailed_Report_${reportDate}.xlsx`;
                    
                    // Export to Excel
                    XLSX.writeFile(wb, filename);
                    
                    // Show success message
                    setPrintStatus({ 
                        success: true, 
                        message: language === 'en' 
                            ? 'Detailed Excel report exported successfully!' 
                            : ' Excel !'
                    });
                    
                    setTimeout(() => setPrintStatus(null), 3000);
                    
                } catch (error) {
                    console.error('Error exporting detailed Excel:', error);
                    setPrintStatus({ 
                        success: false, 
                        message: language === 'en' 
                            ? 'Error exporting detailed report. Please try again.' 
                            : ' '
                    });
                    
                    setTimeout(() => setPrintStatus(null), 3000);
                }
            };

            const filteredOrders = orders.filter(order => {
                const orderDate = new Date(order.date);
                
                if (reportType === 'daily') {
                    return orderDate.toISOString().split('T')[0] === selectedDate;
                } else {
                    return orderDate.toISOString().substring(0, 7) === selectedMonth;
                }
            });
            
            const calculateStats = () => {
                const totalSales = filteredOrders.reduce((sum, order) => sum + order.total, 0);
                const totalOrders = filteredOrders.length;
                const averageOrder = totalOrders > 0 ? totalSales / totalOrders : 0;
                
                const totalProductsSold = filteredOrders.reduce((sum, order) => {
                    return sum + order.items.reduce((itemSum, item) => itemSum + item.quantity, 0);
                }, 0);
                
                return {
                    totalSales: totalSales.toFixed(2),
                    totalOrders,
                    averageOrder: averageOrder.toFixed(2),
                    totalProductsSold
                };
            };
            
            const stats = calculateStats();
            
            const prepareChartData = () => {
                if (reportType === 'daily') {
                    const hours = Array.from({length: 24}, (_, i) => i);
                    const salesByHour = hours.map(hour => {
                        return filteredOrders
                            .filter(order => new Date(order.date).getHours() === hour)
                            .reduce((sum, order) => sum + order.total, 0);
                    });
                    
                    return {
                        labels: hours.map(h => `${h}:00`),
                        data: salesByHour,
                        label: 'Sales by Hour'
                    };
                } else {
                    const daysInMonth = new Date(
                        parseInt(selectedMonth.split('-')[0]),
                        parseInt(selectedMonth.split('-')[1]),
                        0
                    ).getDate();
                    
                    const days = Array.from({length: daysInMonth}, (_, i) => i + 1);
                    const salesByDay = days.map(day => {
                        const dayStr = day < 10 ? `0${day}` : `${day}`;
                        return filteredOrders
                            .filter(order => order.date.startsWith(`${selectedMonth}-${dayStr}`))
                            .reduce((sum, order) => sum + order.total, 0);
                    });
                    
                    return {
                        labels: days.map(d => `${d}`),
                        data: salesByDay,
                        label: 'Sales by Day'
                    };
                }
            };
            
            const chartData = prepareChartData();
            
            const prepareCategoryData = () => {
                const categorySales = {};
                
                filteredOrders.forEach(order => {
                    order.items.forEach(item => {
                        for (const category of Object.keys(menuData)) {
                            if (menuData[category].some(menuItem => menuItem.id === item.id)) {
                                categorySales[category] = (categorySales[category] || 0) + (item.price * item.quantity);
                                if (item.topping) {
                                    categorySales[category] += (item.topping.price * item.quantity);
                                }
                                break;
                            }
                        }
                    });
                });
                
                return {
                    labels: Object.keys(categorySales),
                    data: Object.values(categorySales)
                };
            };
            
            const categoryData = prepareCategoryData();
            
            useEffect(() => {
                if (activeTab !== 'reports') return;
                
                if (dailySalesChartRef.current) {
                    dailySalesChartRef.current.destroy();
                }
                if (categorySalesChartRef.current) {
                    categorySalesChartRef.current.destroy();
                }
                
                const salesCtx = document.getElementById('salesChart');
                const categoryCtx = document.getElementById('categoryChart');
                
                if (salesCtx) {
                    dailySalesChartRef.current = new Chart(salesCtx, {
                        type: 'bar',
                        data: {
                            labels: chartData.labels,
                            datasets: [{
                                label: chartData.label,
                                data: chartData.data,
                                backgroundColor: 'rgba(219, 39, 119, 0.5)',
                                borderColor: 'rgba(219, 39, 119, 1)',
                                borderWidth: 1
                            }]
                        },
                        options: {
                            responsive: true,
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    title: {
                                        display: true,
                                        text: language === 'en' ? 'Sales ($)' : ' ($)'
                                    }
                                }
                            }
                        }
                    });
                }
                
                if (categoryCtx) {
                    categorySalesChartRef.current = new Chart(categoryCtx, {
                        type: 'pie',
                        data: {
                            labels: categoryData.labels.map(label => {
                                const categoryTranslations = {
                                    'HOT SALES': language === 'en' ? 'Hot Sales' : '',
                                    'COFFEE': language === 'en' ? 'Coffee' : '',
                                    'FRAPPE': language === 'en' ? 'Frappe' : '',
                                    'MILK TEA': language === 'en' ? 'Milk Tea' : '',
                                    'OTHER': language === 'en' ? 'Other' : '',
                                    'SODA': language === 'en' ? 'Soda' : ''
                                };
                                return categoryTranslations[label] || label;
                            }),
                            datasets: [{
                                data: categoryData.data,
                                backgroundColor: [
                                    'rgba(219, 39, 119, 0.8)',
                                    'rgba(156, 39, 176, 0.8)',
                                    'rgba(63, 81, 181, 0.8)',
                                    'rgba(33, 150, 243, 0.8)',
                                    'rgba(3, 169, 244, 0.8)',
                                    'rgba(0, 188, 212, 0.8)'
                                ],
                                borderWidth: 1
                        }]
                        },
                        options: {
                            responsive: true,
                            plugins: {
                                legend: {
                                    position: 'right'
                                }
                            }
                        }
                    });
                }
                
                return () => {
                    if (dailySalesChartRef.current) {
                        dailySalesChartRef.current.destroy();
                    }
                    if (categorySalesChartRef.current) {
                        categorySalesChartRef.current.destroy();
                    }
                };
            }, [activeTab, reportType, selectedDate, selectedMonth, language, filteredOrders]);
            
            const addToCart = (item) => {
                setSelectedItem(item);
                setShowCustomizationModal(true);
            };

            const handleCustomization = (sugarLevel, topping) => {
                const itemWithCustomization = { 
                    ...selectedItem, 
                    sugarLevel,
                    topping
                };
                
                const itemKey = `${selectedItem.id}-${sugarLevel}-${topping?.id || 'no-topping'}`;
                
                const existingItem = cart.find(cartItem => 
                    `${cartItem.id}-${cartItem.sugarLevel}-${cartItem.topping?.id || 'no-topping'}` === itemKey
                );
                
                if (existingItem) {
                    setCart(cart.map(cartItem => 
                        `${cartItem.id}-${cartItem.sugarLevel}-${cartItem.topping?.id || 'no-topping'}` === itemKey
                            ? { ...cartItem, quantity: cartItem.quantity + 1 } 
                            : cartItem
                    ));
                } else {
                    setCart([...cart, { ...itemWithCustomization, quantity: 1 }]);
                }
                
                setShowCustomizationModal(false);
                setSelectedItem(null);
            };

            const cancelCustomization = () => {
                setShowCustomizationModal(false);
                setSelectedItem(null);
            };

            const removeFromCart = (id) => {
                setCart(cart.filter(item => item.id !== id));
            };

            const updateQuantity = (id, quantity) => {
                if (quantity <= 0) {
                    removeFromCart(id);
                    return;
                }
                
                setCart(cart.map(item => 
                    item.id === id ? { ...item, quantity } : item
                ));
            };

            const handleSavePrinterSettings = (settings) => {
                setPrinterSettings(settings);
                localStorage.setItem('printerSettings', JSON.stringify(settings));
                setShowPrinterConfig(false);
                setPrintStatus({ 
                    success: true, 
                    message: translations[language].printerSettingsSaved 
                });
                
                setTimeout(() => setPrintStatus(null), 3000);
            };

            const clearOrderHistory = () => {
                if (window.confirm(t.clearHistoryConfirm)) {
                    setOrders([]);
                    setPrintStatus({ 
                        success: true, 
                        message: t.historyCleared 
                    });
                    setTimeout(() => setPrintStatus(null), 3000);
                }
            };

            const handleProductsUpdate = () => {
                // Force re-render by updating state
                setOrders([...orders]);
            };

            const processPayment = async () => {
                if (cart.length === 0) {
                    alert(language === 'en' ? "Cart is empty. Please add items before payment." : " ");
                    return;
                }
                
                const newOrder = {
                    id: orderNumber,
                    date: new Date().toISOString(),
                    items: [...cart],
                    subtotal: getSubtotal(),
                    discount: discount,
                    total: getTotal(),
                    status: 'Completed',
                    cashier: user.displayName
                };
                
                // Update orders state - this will trigger the localStorage save
                setOrders(prevOrders => [...prevOrders, newOrder]);
                setLastOrder(newOrder);
                
                const nextOrderNumber = orderNumber + 1;
                setOrderNumber(nextOrderNumber);
                localStorage.setItem('lastOrderNumber', nextOrderNumber.toString());
                
                setShowReceipt(true);
                
                setPrintStatus({ success: null, message: 'Processing payment...' });
                
                setTimeout(() => {
                    setPrintStatus({ 
                        success: true, 
                        message: 'Payment processed successfully!' 
                    });
                }, 1000);
                
                setTimeout(() => setPrintStatus(null), 5000);
                
                setCart([]);
                setNotes('');
                setDiscount(null);
            };

            const closeReceipt = () => {
                setShowReceipt(false);
            };

            const toggleLanguage = () => {
                setLanguage(prev => prev === 'en' ? 'km' : 'en');
            };

            const togglePriceDisplay = () => {
                setShowKhrPrices(prev => !prev);
            };

            const getCategoryName = (category) => {
                const categoryMap = {
                    'HOT SALES': language === 'en' ? 'HOT SALES' : '',
                    'COFFEE': language === 'en' ? 'COFFEE' : '',
                    'FRAPPE': language === 'en' ? 'FRAPPE' : '',
                    'MILK TEA': language === 'en' ? 'MILK TEA' : '',
                    'OTHER': language === 'en' ? 'OTHER' : '',
                    'SODA': language === 'en' ? 'SODA' : ''
                };
                return categoryMap[category] || category;
            };

            return (
                <div className="dashboard">
                    <header>
                        <div className="logo">
                            <i className="fas fa-crown"></i>
                            Royal Tea&Cafe
                        </div>
                        <div className="header-controls">
                            <div className="language-toggle" onClick={toggleLanguage}>
                                <span className="language-flag">{language === 'en' ? '' : ''}</span>
                                <span>{language === 'en' ? 'EN' : 'KH'}</span>
                            </div>
                            <div className="price-toggle" onClick={togglePriceDisplay}>
                                <i className={`fas ${showKhrPrices ? 'fa-dollar-sign' : 'fa-money-bill'}`}></i>
                                <span>{showKhrPrices ? t.showUsdPrices : t.showKhrPrices}</span>
                            </div>
                            {user.role === 'admin' && (
                                <button 
                                    className="add-product-btn"
                                    onClick={() => setShowProductManager(true)}
                                >
                                    <i className="fas fa-plus"></i>
                                    <span>{t.addProduct}</span>
                                </button>
                            )}
                            <button 
                                className="printer-config-btn"
                                onClick={() => setShowPrinterConfig(true)}
                            >
                                <i className="fas fa-print"></i>
                                <span>{t.configurePrinter}</span>
                            </button>
                            <div className="user-info">
                                <div className="avatar">{user.displayName.charAt(0)}</div>
                                <span>
                                    {user.displayName} 
                                    <span className={`user-role-badge ${user.role}`}>
                                        {user.role}
                                    </span>
                                </span>
                            </div>
                        </div>
                    </header>
                    
                    {/* Platform Info Banner */}
                    {!platformInfoHidden && (
                        <PlatformInfoBanner 
                            platform={platform} 
                            language={language}
                            onHide={hidePlatformInfo}
                        />
                    )}
                    
                    {/* Global Status */}
                    {printStatus && !showPrintStatus && (
                        <div className={`global-status ${printStatus.success === null ? 'info' : printStatus.success ? 'success' : 'error'}`}>
                            {printStatus.message}
                        </div>
                    )}
                    
                    {/* USB Permission Request (Android only) */}
                    {platform.supportsWebUSB && !platform.isIOS && (
                        <USBPermissionRequest 
                            onRequest={testUsbPermission}
                            language={language}
                        />
                    )}
                    
                    <div className="nav-tabs">
                        <div 
                            className={`nav-tab ${activeTab === 'pos' ? 'active' : ''}`}
                            onClick={() => setActiveTab('pos')}
                        >
                            <i className="fas fa-cash-register"></i> {t.pointOfSale}
                        </div>
                        {user.role === 'admin' && (
                            <div 
                                className={`nav-tab ${activeTab === 'reports' ? 'active' : ''}`}
                                onClick={() => setActiveTab('reports')}
                            >
                                <i className="fas fa-chart-line"></i> {t.reports}
                            </div>
                        )}
                    </div>
                    
                    {activeTab === 'pos' ? (
                        <>
                            <ImageSlider />
                            
                            <div className="main-content">
                                <div className="order-section">
                                    <div className="order-header">
                                        <h2>{t.enterSale}</h2>
                                        <div>{t.order} #{orderNumber}</div>
                                    </div>
                                    
                                    <div className="search-container">
                                        <div style={{position: 'relative'}}>
                                            <input
                                                type="text"
                                                className="search-input"
                                                placeholder={t.searchProducts}
                                                value={searchQuery}
                                                onChange={(e) => handleSearch(e.target.value)}
                                            />
                                            <div className="search-icon">
                                                <i className="fas fa-search"></i>
                                            </div>
                                            {searchQuery && (
                                                <button 
                                                    onClick={clearSearch}
                                                    style={{
                                                        position: 'absolute',
                                                        right: '40px',
                                                        top: '50%',
                                                        transform: 'translateY(-50%)',
                                                        background: 'none',
                                                        border: 'none',
                                                        color: '#db2777',
                                                        cursor: 'pointer'
                                                    }}
                                                >
                                                    <i className="fas fa-times"></i>
                                                </button>
                                            )}
                                        </div>
                                        {searchQuery && (
                                            <div className="search-results-info">
                                                {searchResults.length > 0 ? (
                                                    <span>
                                                        {t.showingResultsFor}: "<strong>{searchQuery}</strong>" 
                                                        ({searchResults.length} {language === 'en' ? 'products found' : ''})
                                                    </span>
                                                ) : (
                                                    <span>{t.noResultsFound}: "<strong>{searchQuery}</strong>"</span>
                                                )}
                                            </div>
                                        )}
                                    </div>
                                    
                                    {!searchQuery && (
                                        <div className="categories">
                                            {Object.keys(menuData).map(category => (
                                                <button
                                                    key={category}
                                                    className={`category-btn ${activeCategory === category ? 'active' : ''}`}
                                                    onClick={() => setActiveCategory(category)}
                                                >
                                                    {getCategoryName(category)}
                                                </button>
                                            ))}
                                        </div>
                                    )}
                                    
                                    <div className="menu-container">
                                        <div className="menu-grid">
                                            {getProductsToDisplay().map(item => (
                                                <div key={item.id} className="menu-item" onClick={() => addToCart(item)}>
                                                    <img src={item.image} alt={item.name} className="menu-item-image" />
                                                    <h3>{language === 'en' ? item.name : item.nameKh}</h3>
                                                    <small>{language === 'en' ? item.nameKh : item.name}</small>
                                                    {item.category && searchQuery && (
                                                        <small style={{color: '#db2777', fontWeight: 'bold'}}>
                                                            {getCategoryName(item.category)}
                                                        </small>
                                                    )}
                                                    <p>
                                                        <span className="usd-price">${item.price.toFixed(2)}</span>
                                                        {showKhrPrices && (
                                                            <div className="khmer-price">{formatKhrPrice(usdToKhr(item.price))}</div>
                                                        )}
                                                    </p>
                                                </div>
                                            ))}
                                        </div>
                                        {searchQuery && searchResults.length === 0 && (
                                            <div className="empty-cart">
                                                <i className="fas fa-search"></i>
                                                <p>{t.noResultsFound}</p>
                                                <button 
                                                    className="category-btn" 
                                                    onClick={clearSearch}
                                                    style={{marginTop: '10px'}}
                                                >
                                                    {t.clearSearch}
                                                </button>
                                            </div>
                                        )}
                                    </div>
                                </div>
                                
                                <div className="cart-section">
                                    <div className="cart-header">
                                        <h2>{language === 'en' ? 'Current Order' : ''}</h2>
                                        <span>{cart.length} {t.items}</span>
                                    </div>
                                    
                                    <div className="cart-items">
                                        {cart.length === 0 ? (
                                            <div className="empty-cart">
                                                <i className="fas fa-shopping-cart"></i>
                                                <p>{t.noItems}</p>
                                            </div>
                                        ) : (
                                            cart.map(item => {
                                                const itemTotal = (item.price + (item.topping ? item.topping.price : 0)) * item.quantity;
                                                return (
                                                    <div key={`${item.id}-${item.sugarLevel}-${item.topping?.id}`} className="cart-item">
                                                        <div className="cart-item-details">
                                                            <span className="cart-item-name">
                                                                {language === 'en' ? item.name : item.nameKh} 
                                                                {item.sugarLevel && ` (${item.sugarLevel} ${language === 'en' ? 'sugar' : ''})`}
                                                                {item.topping && ` + ${language === 'en' ? item.topping.name : item.topping.nameKh}`}
                                                            </span>
                                                            <div className="cart-item-controls">
                                                                <button className="quantity-btn" onClick={(e) => {
                                                                    e.stopPropagation();
                                                                    updateQuantity(item.id, item.quantity - 1);
                                                                }}>-</button>
                                                                <span>{item.quantity}</span>
                                                                <button className="quantity-btn" onClick={(e) => {
                                                                    e.stopPropagation();
                                                                    updateQuantity(item.id, item.quantity + 1);
                                                                }}>+</button>
                                                            </div>
                                                        </div>
                                                        <div className="cart-item-price">
                                                            <span className="usd-price">${itemTotal.toFixed(2)}</span>
                                                            {showKhrPrices && (
                                                                <div className="khmer-price">{formatKhrPrice(usdToKhr(itemTotal))}</div>
                                                            )}
                                                        </div>
                                                    </div>
                                                );
                                            })
                                        )}
                                    </div>
                                    
                                    <div className="discount-section">
                                        <h3>{t.discount}</h3>
                                        <div className="discount-controls">
                                            <input
                                                type="number"
                                                className="discount-input"
                                                placeholder={t.enterDiscount}
                                                value={discountAmount}
                                                onChange={(e) => setDiscountAmount(e.target.value)}
                                                min="0"
                                                step={discountType === 'percentage' ? "1" : "0.01"}
                                            />
                                            <select 
                                                className="discount-type"
                                                value={discountType}
                                                onChange={(e) => setDiscountType(e.target.value)}
                                            >
                                                <option value="percentage">%</option>
                                                <option value="fixed">$</option>
                                            </select>
                                        </div>
                                        <div className="discount-buttons">
                                            <button className="apply-discount-btn" onClick={applyDiscount}>
                                                {t.applyDiscount}
                                            </button>
                                            <button className="remove-discount-btn" onClick={removeDiscount}>
                                                {t.removeDiscount}
                                            </button>
                                        </div>
                                        {discount && (
                                            <div className="discount-applied">
                                                {t.discountApplied}: {discount.amount}{discount.type === 'percentage' ? '%' : '$'}
                                            </div>
                                        )}
                                    </div>
                                    
                                    <div className="cart-totals">
                                        <div className="total-row">
                                            <span>{t.subtotal}</span>
                                            <span className="cart-item-price">
                                                <span className="usd-price">${getSubtotal().toFixed(2)}</span>
                                                {showKhrPrices && (
                                                    <div className="khmer-price">{formatKhrPrice(usdToKhr(getSubtotal()))}</div>
                                                )}
                                            </span>
                                        </div>
                                        
                                        {discount && discount.amount > 0 && (
                                            <div className="total-row discount-row">
                                                <span>{t.discount}: 
                                                    {discount.type === 'percentage' ? ` (${discount.amount}%)` : ''}
                                                </span>
                                                <span className="cart-item-price">
                                                    <span className="usd-price">-${getDiscountAmount().toFixed(2)}</span>
                                                    {showKhrPrices && (
                                                        <div className="khmer-price">-{formatKhrPrice(usdToKhr(getDiscountAmount()))}</div>
                                                    )}
                                                </span>
                                        </div>
                                        )}
                                        
                                        <div className="total-row total-final">
                                            <span>{t.total}</span>
                                            <span className="cart-item-price">
                                                <span className="usd-price">${getTotal().toFixed(2)}</span>
                                                {showKhrPrices && (
                                                    <div className="khmer-price khmer-total">{formatKhrPrice(usdToKhr(getTotal()))}</div>
                                                )}
                                            </span>
                                        </div>
                                    </div>
                                    
                                    <button className="pay-btn" onClick={processPayment}>
                                        <i className="fas fa-credit-card"></i>
                                        {t.pay} 
                                        <span className="usd-price"> ${getTotal().toFixed(2)}</span>
                                        {showKhrPrices && (
                                            <span className="khmer-font"> ({formatKhrPrice(usdToKhr(getTotal()))})</span>
                                        )}
                                    </button>
                                    
                                    <div className="notes-section">
                                        <h3>{t.addNotes}</h3>
                                        <textarea 
                                            value={notes} 
                                            onChange={(e) => setNotes(e.target.value)}
                                            placeholder={t.specialInstructions}
                                        />
                                    </div>
                                </div>
                            </div>
                        </>
                    ) : (
                        <div className="reports-section active">
                            <div className="report-controls">
                                <div className="report-control">
                                    <label>{t.reportType}</label>
                                    <select value={reportType} onChange={(e) => setReportType(e.target.value)}>
                                        <option value="daily">{t.dailyReport}</option>
                                        <option value="monthly">{t.monthlyReport}</option>
                                    </select>
                                </div>
                                
                                {reportType === 'daily' ? (
                                    <div className="report-control">
                                        <label>{t.selectDate}</label>
                                        <input 
                                            type="date" 
                                            value={selectedDate} 
                                            onChange={(e) => setSelectedDate(e.target.value)}
                                        />
                                    </div>
                                ) : (
                                    <div className="report-control">
                                        <label>{t.selectMonth}</label>
                                        <input 
                                            type="month" 
                                            value={selectedMonth} 
                                            onChange={(e) => setSelectedMonth(e.target.value)}
                                        />
                                    </div>
                                )}
                                
                                <div className="report-buttons">
                                    <button className="excel-export-btn" onClick={exportToExcel}>
                                        <i className="fas fa-file-excel"></i> {t.exportToExcel}
                                    </button>
                                    <button className="excel-export-btn detailed" onClick={exportDetailedExcel}>
                                        <i className="fas fa-file-excel"></i> {t.exportDetailedExcel}
                                    </button>
                                    <button className="clear-history-btn" onClick={clearOrderHistory}>
                                        <i className="fas fa-trash"></i> {t.clearHistory}
                                    </button>
                                </div>
                            </div>
                            
                            <div className="report-summary">
                                <div className="summary-card">
                                    <h3>{t.totalSales}</h3>
                                    <div className="value">
                                        <span className="usd-price">${stats.totalSales}</span>
                                        {showKhrPrices && (
                                            <div className="khmer-price">{formatKhrPrice(usdToKhr(parseFloat(stats.totalSales)))}</div>
                                        )}
                                    </div>
                                </div>
                                <div className="summary-card">
                                    <h3>{t.totalOrders}</h3>
                                    <div className="value">{stats.totalOrders}</div>
                                </div>
                                <div className="summary-card">
                                    <h3>{t.averageOrder}</h3>
                                    <div className="value">
                                        <span className="usd-price">${stats.averageOrder}</span>
                                        {showKhrPrices && (
                                            <div className="khmer-price">{formatKhrPrice(usdToKhr(parseFloat(stats.averageOrder)))}</div>
                                        )}
                                    </div>
                                </div>
                                <div className="summary-card">
                                    <h3>{t.productsSold}</h3>
                                    <div className="value">{stats.totalProductsSold}</div>
                                </div>
                            </div>
                            
                            <div className="chart-container">
                                <div className="chart-title">
                                    {reportType === 'daily' ? t.dailySalesReport : t.monthlySalesReport}
                                </div>
                                <canvas id="salesChart"></canvas>
                            </div>
                            
                            <div className="chart-container">
                                <div className="chart-title">{t.salesByCategory}</div>
                                <canvas id="categoryChart"></canvas>
                            </div>
                            
                            <h3>{t.orderDetails}</h3>
                            {filteredOrders.length > 0 ? (
                                <table className="orders-table">
                                    <thead>
                                        <tr>
                                            <th>{t.orderId}</th>
                                            <th>{t.dateTime}</th>
                                            <th>{language === 'en' ? 'Cashier' : ''}</th>
                                            <th>{language === 'en' ? 'Items' : ''}</th>
                                            <th>{t.total}</th>
                                            <th>{t.status}</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {filteredOrders.map(order => (
                                            <tr key={order.id}>
                                                <td>#{order.id}</td>
                                                <td>{new Date(order.date).toLocaleString()}</td>
                                                <td>{order.cashier || 'N/A'}</td>
                                                <td>
                                                    {order.items.map(item => (
                                                        <div key={item.id}>
                                                            {item.quantity}x {language === 'en' ? item.name : item.nameKh} 
                                                            {item.sugarLevel && ` (${item.sugarLevel} ${language === 'en' ? 'sugar' : ''})`}
                                                            {item.topping && ` + ${language === 'en' ? item.topping.name : item.topping.nameKh}`}
                                                            (${(item.price + (item.topping ? item.topping.price : 0)).toFixed(2)})
                                                        </div>
                                                    ))}
                                                </td>
                                                <td>
                                                    <div className="cart-item-price">
                                                        <span className="usd-price">${order.total.toFixed(2)}</span>
                                                        {showKhrPrices && (
                                                            <div className="khmer-price">{formatKhrPrice(usdToKhr(order.total))}</div>
                                                        )}
                                                    </div>
                                                </td>
                                                <td>
                                                    <span className={`status ${order.status.toLowerCase()}`}>
                                                        {order.status}
                                                    </span>
                                                </td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            ) : (
                                <div className="no-orders">
                                    <i className="fas fa-file-invoice"></i>
                                    <p>{t.noOrders} {reportType === 'daily' ? (language === 'en' ? 'for the selected date' : '') : (language === 'en' ? 'for the selected month' : '')}</p>
                                </div>
                            )}
                        </div>
                    )}
                    
                    {/* Print Status Modal */}
                    {showPrintStatus && (
                        <PrintStatusModal 
                            status={printStatus}
                            onRetry={retryPrint}
                            onFallback={fallbackToBrowserPrint}
                            onClose={closePrintStatus}
                            language={language}
                        />
                    )}
                    
                    {/* Existing modals... */}
                    {showCustomizationModal && (
                        <CustomizationModal 
                            item={selectedItem}
                            onConfirm={handleCustomization}
                            onCancel={cancelCustomization}
                            language={language}
                            showKhrPrices={showKhrPrices}
                        />
                    )}
                    
                    {showReceipt && (
                        <ReceiptModal 
                            cart={lastOrder.items}
                            notes={notes}
                            orderNumber={lastOrder.id}
                            onClose={closeReceipt}
                            onPrint={printReceipt}
                            language={language}
                            showKhrPrices={showKhrPrices}
                            discount={lastOrder.discount}
                        />
                    )}
                    
                    {showPrinterConfig && (
                        <PrinterConfigModal 
                            onClose={() => setShowPrinterConfig(false)}
                            onSave={handleSavePrinterSettings}
                            language={language}
                            currentSettings={printerSettings}
                        />
                    )}
                    
                    {showProductManager && (
                        <ProductManagerModal 
                            onClose={() => setShowProductManager(false)}
                            language={language}
                            onProductsUpdate={handleProductsUpdate}
                            user={user}
                        />
                    )}
                </div>
            );
        };

        // Function to initialize the POS system after login
        function initializePOS(user) {
            ReactDOM.render(<CafeDashboard user={user} />, document.getElementById('root'));
        }
    </script>
</body>
</html>
